
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>A comparison of actual thrombolysis rates across hospitals: subgroup analysis &#8212; What would other emgerncy stroke teams do? Using explainable machine learning to understand variation in thrombolysis practice</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compare local thrombolysis decisions with benchmark decisions" href="05_compare_benchmark_decisions_key_features.html" />
    <link rel="prev" title="A comparison of expected 10k cohort thrombolysis rates across hospitals: subgroup analysis" href="15_10k_thrombolysis_subgroups.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">What would other emgerncy stroke teams do? Using explainable machine learning to understand variation in thrombolysis practice</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../introduction/intro.html">
                    SAMueL (Stroke Audit Machine Learning): What would other emergency stroke teams? Summary and key work
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introductory content
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/data.html">
   Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/odds_prob.html">
   Probability, odds, and SHAP values (log odds shifts)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/shap_worked_example.html">
   A simple worked example of Shap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="90_shap_interactions_on_titanic.html">
   Examining interactions between features with SHAP interactions: Using Titanic survival as an example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Predicting thrombolysis use and explaining the predictions with Shap
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_xgb_combined_fit_feature_selection.html">
   XGBoost feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_correlation.html">
   Check correlation between features selected for the model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_xgb_combined_fit_accuracy_key_features.html">
   Measuring accuracy of XGBoost models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02a_xgb_combined_fit_most_thrombolysable_patients.html">
   An anlysis of the characteristics of the most thrombolysable patient at each hopsital
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_xgb_combined_shap_key_features.html">
   Explaining XGBoost model predictions with SHAP values
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Comparing thrombolysis decisions between hospitals
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04_compare_10k_cohort_key_features.html">
   A comparison of 10k cohort thrombolysis rates across hospitals, and comparison with hospital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_10k_thrombolysis_subgroups.html">
   A comparison of expected 10k cohort thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   A comparison of actual thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_compare_benchmark_decisions_key_features.html">
   Compare local thrombolysis decisions with benchmark decisions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_xgb_combined_fit_shap_high_vs_low_thrombolysing_units.html">
   Comparing Shap values between high and low thrombolysing hospitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_plot_thrombolysis_at_high_vs_low_thrombolysing_units.html">
   Plotting thrombolysis rate by feature value for low and high thrombolysing hopsitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03c_xgb_shap_values_and_interaction_values_focus_on_ohe_hospitals.html">
   Explaining XGBoost model predictions with SHAP values: Analysis of hopsital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12a_xgb_shap_interactions.html">
   Describing model predictions, using SHAP values and SHAP interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12aa_xgb_shap_interactions_focus_on_onsettime.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Precise Onset Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12ab_xgb_shap_interactions_focus_on_severity.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Stroke Severity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12ac_xgb_shap_interactions_focus_on_disability.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with pre-stroke disability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_synthetic_patients.html">
   Investigating the effect of patient features by varying feature values in artificial patients
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="50_bagging_variation.html">
   Evaluating variation in model predictions and predicted 10k thrombolysis rate using bootstrap models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="91_learning_rate_optimisation.html">
   Evaluation of XGBoost learning rates on distribution of 10k thrombolysis rates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Paper (Work In Progress)
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../paper/abstract.html">
   Abstract
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../paper/3_results.html">
   Results
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../paper/6_appendix.html">
   Appendix
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/xgb_10_features/15a_observed_thrombolysis_subgroup_analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plain-english-summary">
   Plain English summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-analysis">
   Data and analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#observations">
   Observations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-packages">
   Import packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-thrombolysis-use-in-subgroups-at-each-hopsital">
   Get thrombolysis use in subgroups at each hopsital
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-results">
   Plot results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-summary-of-results">
   Show summary of results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#violin-plot-of-results">
   Violin plot of results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-with-model-results">
   Compare with model results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-correlations-betwen-subgroups">
     Check correlations betwen subgroups
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>A comparison of actual thrombolysis rates across hospitals: subgroup analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plain-english-summary">
   Plain English summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-and-analysis">
   Data and analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#observations">
   Observations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-packages">
   Import packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-thrombolysis-use-in-subgroups-at-each-hopsital">
   Get thrombolysis use in subgroups at each hopsital
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-results">
   Plot results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-summary-of-results">
   Show summary of results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#violin-plot-of-results">
   Violin plot of results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-with-model-results">
   Compare with model results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-correlations-betwen-subgroups">
     Check correlations betwen subgroups
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="a-comparison-of-actual-thrombolysis-rates-across-hospitals-subgroup-analysis">
<h1>A comparison of actual thrombolysis rates across hospitals: subgroup analysis<a class="headerlink" href="#a-comparison-of-actual-thrombolysis-rates-across-hospitals-subgroup-analysis" title="Permalink to this headline">#</a></h1>
<section id="plain-english-summary">
<h2>Plain English summary<a class="headerlink" href="#plain-english-summary" title="Permalink to this headline">#</a></h2>
<p>We have previously predicted the thrombolysis use in subgroups, if all hopsitals saw the same 10 thousand patients. In this notebook we look at subgroup analysis of actual thrombolysis use. One difference between this and the previous work, is that when we look at observed thrombolysis use, then the patients in the subgroups are different at each hopsital, but we can still look for agreement in general patterns.</p>
<p>As with the predicted thrombolysis use (if all hopsitals saw the same patients), we see the same patterns. All stroke units show high expected thrombolysis in a set of ‘ideal’ thrombolysis patients, but vary in expected use in subgroups with low stroke severity, no precise onset time, or existing pre-stroke disability. If a stroke unit showed lower  thombolysis in one of these subgroups they also tended to show lower thrombolysis rates in the other subgroups - suggesting a shared caution in use of thrombolysis in ‘less ideal’ patients.</p>
</section>
<section id="data-and-analysis">
<h2>Data and analysis<a class="headerlink" href="#data-and-analysis" title="Permalink to this headline">#</a></h2>
<p>This analysis is for patients who arrive within 4 hours of known stroke onset. The data is the observed thrombolsyis use at each hopsital (not modelled/predicted thrombolysis use).</p>
<p>We look at thrombolysis use by subgroup in four groups (in addiitonal to total thrombolysis use).</p>
<ul class="simple">
<li><p>Mild stroke severity (NIHSS &lt; 5)</p></li>
<li><p>No precise onset time</p></li>
<li><p>Existing pre-stroke disability (mRS &gt; 2)</p></li>
<li><p>An <em>ideal</em> thrombolysable patient:</p>
<ul>
<li><p>Stroke severity NIHSS in range 10-25</p></li>
<li><p>Arrival-to-scan time &lt; 30 minutes</p></li>
<li><p>Stroke type = infarction</p></li>
<li><p>Precise onset time = True</p></li>
<li><p>Prior diability level (mRS) = 0</p></li>
<li><p>No use of AF anticoagulants</p></li>
<li><p>Onset-to-arrival time &lt; 90 minutes</p></li>
<li><p>Age &lt; 80 years</p></li>
<li><p>Onset during sleep = False</p></li>
</ul>
</li>
</ul>
</section>
<section id="observations">
<h2>Observations<a class="headerlink" href="#observations" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>The observed and predicted subgroup analysis show very similar general patterns (with r-sqaured=0.95). The three subgroups of NIHSS &lt;5, no precise stroke onset time, and prestroke mRS &gt; 2, all had reduced thrombolysis use, and combining these non-ideal features reduced thrombolysis use further.</p></li>
<li><p>The three subgroups of NIHSS &lt;5, no precise stroke onset time, and prestroke mRS &gt; 2, tended to reduce in parallel, along with total thrombolysis use, suggesting a shared caution in use of thrombolysis in ‘less ideal’ patients.</p></li>
<li><p>Some differences exist:</p>
<ul>
<li><p>The use of thrombolysi in <em>ideal</em> patients is a little low in the observed vs actual results (mean hopsital thrombolysis use = 89% vs 99%).</p></li>
<li><p>The predicted results show a stronger effect of combining non-ideal features.</p></li>
<li><p>The observed thrombolysis rate shows higher between-hopsital variation than the predicted thrombolysis rate. This may be partly explained by the observed thrombolsysi rate being on different patients at each hospital, but may also be partly exlained by actual use of thrombolysis being slightly more variable than predicted thrombolysis use (which will follow general hospial patterns, and will not include, for example, between-clinician variation at each hospital).</p></li>
</ul>
</li>
</ul>
</section>
<section id="import-packages">
<h2>Import packages<a class="headerlink" href="#import-packages" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-data">
<h2>Import data<a class="headerlink" href="#import-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load one k-fold, and join to get full data</span>
<span class="n">data_loc</span> <span class="o">=</span> <span class="s1">&#39;../data/kfold_5fold/&#39;</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_loc</span> <span class="o">+</span> <span class="s1">&#39;train_0.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_loc</span> <span class="o">+</span> <span class="s1">&#39;test_0.csv&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">])</span>

<span class="c1"># Restrict data fields and rename</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./output/01_feature_name_dict.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">feature_name_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
<span class="n">number_of_features_to_use</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">key_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./output/01_feature_selection.csv&#39;</span><span class="p">)</span>
<span class="n">key_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key_features</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">])[:</span><span class="n">number_of_features_to_use</span><span class="p">]</span>
<span class="n">key_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;S2Thrombolysis&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key_features</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">feature_name_dict</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Arrival-to-scan time</th>
      <th>Infarction</th>
      <th>Stroke severity</th>
      <th>Precise onset time</th>
      <th>Prior disability level</th>
      <th>Stroke team</th>
      <th>Use of AF anticoagulants</th>
      <th>Onset-to-arrival time</th>
      <th>Onset during sleep</th>
      <th>Age</th>
      <th>Thrombolysis</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14.0</td>
      <td>0</td>
      <td>24.0</td>
      <td>1</td>
      <td>0</td>
      <td>APXEE8191H</td>
      <td>0</td>
      <td>106.0</td>
      <td>0</td>
      <td>92.5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>1</td>
      <td>0</td>
      <td>EQZZZ5658G</td>
      <td>0</td>
      <td>144.0</td>
      <td>0</td>
      <td>72.5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>1</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>QOAPO4699N</td>
      <td>0</td>
      <td>83.0</td>
      <td>0</td>
      <td>72.5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19.0</td>
      <td>1</td>
      <td>12.0</td>
      <td>1</td>
      <td>4</td>
      <td>JINXD0311F</td>
      <td>0</td>
      <td>78.0</td>
      <td>0</td>
      <td>57.5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>22.0</td>
      <td>1</td>
      <td>27.0</td>
      <td>1</td>
      <td>3</td>
      <td>HBFCN1575G</td>
      <td>1</td>
      <td>145.0</td>
      <td>0</td>
      <td>82.5</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="get-thrombolysis-use-in-subgroups-at-each-hopsital">
<h2>Get thrombolysis use in subgroups at each hopsital<a class="headerlink" href="#get-thrombolysis-use-in-subgroups-at-each-hopsital" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

<span class="c1"># Group data by hopsital</span>
<span class="n">grouped_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Stroke team&#39;</span><span class="p">)</span>

<span class="c1"># Loop through hopsitals</span>
<span class="k">for</span> <span class="n">hospital</span><span class="p">,</span> <span class="n">hosp_data</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">:</span>
    <span class="n">hosp_results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
    <span class="c1"># Thrombolysis for all patients </span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Thrombolysis for ideal patients</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> 
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Arrival-to-scan time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Infarction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Precise onset time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Prior disability level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Use of AF anticoagulants&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Onset-to-arrival time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Onset during sleep&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;Ideal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Mild stroke (NIHSS &lt; 5)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># No precise onset time</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Precise onset time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;No precise onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Prior disability</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Prior disability level&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Age</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">80</span> 
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Mild stroke (NIHSS &lt; 5) and no precise onset</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> 
            <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Precise onset time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;NIHSS + Precise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Mild stroke (NIHSS &lt; 5) and prestroke disability</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> 
            <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Prior disability level&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;NIHSS + Disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># No precise onset and prestroke disability</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Precise onset time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
            <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Prior disability level&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;Precise + Disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># NIHSS &lt; 5, No precise onset, and prestroke disability</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Stroke severity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Precise onset time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> 
            <span class="p">(</span><span class="n">hosp_data</span><span class="p">[</span><span class="s1">&#39;Prior disability level&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">hosp_results</span><span class="p">[</span><span class="s1">&#39;NIHSS + Precise + Disability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_data</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;Thrombolysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Add to all results</span>
    <span class="n">results</span><span class="p">[</span><span class="n">hospital</span><span class="p">]</span> <span class="o">=</span> <span class="n">hosp_results</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">results</span> <span class="o">*=</span> <span class="mi">100</span> <span class="c1"># (Convert to percent)</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>All patients</th>
      <th>Ideal</th>
      <th>NIHSS &lt; 5</th>
      <th>No precise onset</th>
      <th>mRS &gt; 2</th>
      <th>Age &gt; 80</th>
      <th>NIHSS + Precise</th>
      <th>NIHSS + Disability</th>
      <th>Precise + Disability</th>
      <th>NIHSS + Precise + Disability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AGNOF1041H</th>
      <td>35.246843</td>
      <td>82.051282</td>
      <td>15.210356</td>
      <td>18.623482</td>
      <td>21.379310</td>
      <td>29.189189</td>
      <td>2.409639</td>
      <td>0.000000</td>
      <td>8.771930</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>AKCGO9726K</th>
      <td>36.974790</td>
      <td>86.206897</td>
      <td>23.049645</td>
      <td>18.539326</td>
      <td>33.887043</td>
      <td>35.044248</td>
      <td>8.275862</td>
      <td>10.606061</td>
      <td>17.177914</td>
      <td>4.761905</td>
    </tr>
    <tr>
      <th>AOBTM3098N</th>
      <td>21.880342</td>
      <td>80.000000</td>
      <td>2.690583</td>
      <td>5.813953</td>
      <td>11.926606</td>
      <td>18.309859</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.555556</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>APXEE8191H</th>
      <td>22.648084</td>
      <td>100.000000</td>
      <td>6.329114</td>
      <td>12.356322</td>
      <td>13.636364</td>
      <td>20.270270</td>
      <td>2.597403</td>
      <td>0.000000</td>
      <td>5.333333</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ATDID5461S</th>
      <td>24.038462</td>
      <td>100.000000</td>
      <td>14.150943</td>
      <td>2.727273</td>
      <td>9.756098</td>
      <td>16.265060</td>
      <td>0.000000</td>
      <td>7.142857</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>YPKYH1768F</th>
      <td>24.605678</td>
      <td>87.500000</td>
      <td>5.185185</td>
      <td>2.409639</td>
      <td>11.475410</td>
      <td>21.568627</td>
      <td>0.000000</td>
      <td>5.555556</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>YQMZV4284N</th>
      <td>23.617021</td>
      <td>100.000000</td>
      <td>7.389163</td>
      <td>6.074766</td>
      <td>20.754717</td>
      <td>22.594142</td>
      <td>0.000000</td>
      <td>2.439024</td>
      <td>5.681818</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ZBVSO0975W</th>
      <td>25.000000</td>
      <td>76.923077</td>
      <td>12.435233</td>
      <td>14.705882</td>
      <td>20.512821</td>
      <td>23.560209</td>
      <td>22.222222</td>
      <td>0.000000</td>
      <td>4.166667</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ZHCLE1578P</th>
      <td>22.363946</td>
      <td>100.000000</td>
      <td>6.067416</td>
      <td>22.070145</td>
      <td>18.181818</td>
      <td>20.000000</td>
      <td>6.067416</td>
      <td>2.325581</td>
      <td>18.279570</td>
      <td>2.325581</td>
    </tr>
    <tr>
      <th>ZRRCV7012C</th>
      <td>15.767045</td>
      <td>100.000000</td>
      <td>6.250000</td>
      <td>2.380952</td>
      <td>6.000000</td>
      <td>12.121212</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>132 rows × 10 columns</p>
</div></div></div>
</div>
</section>
<section id="plot-results">
<h2>Plot results<a class="headerlink" href="#plot-results" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorted_results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;Ideal&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Ideal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;No precise onset&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hopsital&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed percent of patients receiving thrombolysis&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;No precise onset&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">[</span><span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hopsital&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed percent of patients receiving thrombolysis&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/15a_actual_subgroup.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/15a_observed_thrombolysis_subgroup_analysis_9_0.png" src="../_images/15a_observed_thrombolysis_subgroup_analysis_9_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>All patients</th>
      <th>Ideal</th>
      <th>NIHSS &lt; 5</th>
      <th>No precise onset</th>
      <th>mRS &gt; 2</th>
      <th>Age &gt; 80</th>
      <th>NIHSS + Precise</th>
      <th>NIHSS + Disability</th>
      <th>Precise + Disability</th>
      <th>NIHSS + Precise + Disability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AGNOF1041H</th>
      <td>35.246843</td>
      <td>82.051282</td>
      <td>15.210356</td>
      <td>18.623482</td>
      <td>21.379310</td>
      <td>29.189189</td>
      <td>2.409639</td>
      <td>0.000000</td>
      <td>8.771930</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>AKCGO9726K</th>
      <td>36.974790</td>
      <td>86.206897</td>
      <td>23.049645</td>
      <td>18.539326</td>
      <td>33.887043</td>
      <td>35.044248</td>
      <td>8.275862</td>
      <td>10.606061</td>
      <td>17.177914</td>
      <td>4.761905</td>
    </tr>
    <tr>
      <th>AOBTM3098N</th>
      <td>21.880342</td>
      <td>80.000000</td>
      <td>2.690583</td>
      <td>5.813953</td>
      <td>11.926606</td>
      <td>18.309859</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.555556</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>APXEE8191H</th>
      <td>22.648084</td>
      <td>100.000000</td>
      <td>6.329114</td>
      <td>12.356322</td>
      <td>13.636364</td>
      <td>20.270270</td>
      <td>2.597403</td>
      <td>0.000000</td>
      <td>5.333333</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ATDID5461S</th>
      <td>24.038462</td>
      <td>100.000000</td>
      <td>14.150943</td>
      <td>2.727273</td>
      <td>9.756098</td>
      <td>16.265060</td>
      <td>0.000000</td>
      <td>7.142857</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>YPKYH1768F</th>
      <td>24.605678</td>
      <td>87.500000</td>
      <td>5.185185</td>
      <td>2.409639</td>
      <td>11.475410</td>
      <td>21.568627</td>
      <td>0.000000</td>
      <td>5.555556</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>YQMZV4284N</th>
      <td>23.617021</td>
      <td>100.000000</td>
      <td>7.389163</td>
      <td>6.074766</td>
      <td>20.754717</td>
      <td>22.594142</td>
      <td>0.000000</td>
      <td>2.439024</td>
      <td>5.681818</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ZBVSO0975W</th>
      <td>25.000000</td>
      <td>76.923077</td>
      <td>12.435233</td>
      <td>14.705882</td>
      <td>20.512821</td>
      <td>23.560209</td>
      <td>22.222222</td>
      <td>0.000000</td>
      <td>4.166667</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>ZHCLE1578P</th>
      <td>22.363946</td>
      <td>100.000000</td>
      <td>6.067416</td>
      <td>22.070145</td>
      <td>18.181818</td>
      <td>20.000000</td>
      <td>6.067416</td>
      <td>2.325581</td>
      <td>18.279570</td>
      <td>2.325581</td>
    </tr>
    <tr>
      <th>ZRRCV7012C</th>
      <td>15.767045</td>
      <td>100.000000</td>
      <td>6.250000</td>
      <td>2.380952</td>
      <td>6.000000</td>
      <td>12.121212</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>132 rows × 10 columns</p>
</div></div></div>
</div>
<p>Show correlations between major subgroups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Correlations between subgroups:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;-------------------------------&#39;</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="s1">&#39;Ideal&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))):</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> \
            <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">f1</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="n">f2</span><span class="p">])</span>
        <span class="n">r_square</span> <span class="o">=</span> <span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">f2</span><span class="si">}</span><span class="s1">: r-square = </span><span class="si">{</span><span class="n">r_square</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, p = </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlations between subgroups:
-------------------------------
All patients - Ideal: r-square = 0.006, p = 0.3646
All patients - NIHSS &lt; 5: r-square = 0.661, p = 0.0000
All patients - No precise onset: r-square = 0.344, p = 0.0000
All patients - mRS &gt; 2: r-square = 0.528, p = 0.0000
Ideal - NIHSS &lt; 5: r-square = 0.003, p = 0.5198
Ideal - No precise onset: r-square = 0.000, p = 0.8747
Ideal - mRS &gt; 2: r-square = 0.010, p = 0.2583
NIHSS &lt; 5 - No precise onset: r-square = 0.221, p = 0.0000
NIHSS &lt; 5 - mRS &gt; 2: r-square = 0.308, p = 0.0000
No precise onset - mRS &gt; 2: r-square = 0.289, p = 0.0000
</pre></div>
</div>
</div>
</div>
</section>
<section id="show-summary-of-results">
<h2>Show summary of results<a class="headerlink" href="#show-summary-of-results" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>All patients</th>
      <td>132.0</td>
      <td>28.618779</td>
      <td>7.645344</td>
      <td>6.250000</td>
      <td>23.513019</td>
      <td>28.007450</td>
      <td>33.659365</td>
      <td>48.756219</td>
    </tr>
    <tr>
      <th>Ideal</th>
      <td>132.0</td>
      <td>89.175667</td>
      <td>9.197675</td>
      <td>50.000000</td>
      <td>83.982143</td>
      <td>90.454545</td>
      <td>96.038462</td>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>NIHSS &lt; 5</th>
      <td>132.0</td>
      <td>11.422620</td>
      <td>6.965480</td>
      <td>0.490196</td>
      <td>6.420988</td>
      <td>10.572275</td>
      <td>14.489520</td>
      <td>40.845070</td>
    </tr>
    <tr>
      <th>No precise onset</th>
      <td>132.0</td>
      <td>11.576738</td>
      <td>7.882359</td>
      <td>0.000000</td>
      <td>5.263158</td>
      <td>10.027830</td>
      <td>16.461749</td>
      <td>33.949192</td>
    </tr>
    <tr>
      <th>mRS &gt; 2</th>
      <td>132.0</td>
      <td>17.225861</td>
      <td>8.150170</td>
      <td>0.000000</td>
      <td>11.085627</td>
      <td>17.004327</td>
      <td>22.443219</td>
      <td>39.166667</td>
    </tr>
    <tr>
      <th>Age &gt; 80</th>
      <td>132.0</td>
      <td>24.086885</td>
      <td>8.144390</td>
      <td>4.545455</td>
      <td>18.956249</td>
      <td>23.205515</td>
      <td>29.754550</td>
      <td>52.307692</td>
    </tr>
    <tr>
      <th>NIHSS + Precise</th>
      <td>132.0</td>
      <td>4.185051</td>
      <td>4.891655</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.667141</td>
      <td>6.274700</td>
      <td>25.925926</td>
    </tr>
    <tr>
      <th>NIHSS + Disability</th>
      <td>132.0</td>
      <td>4.089944</td>
      <td>5.230294</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.964427</td>
      <td>6.250000</td>
      <td>28.571429</td>
    </tr>
    <tr>
      <th>Precise + Disability</th>
      <td>132.0</td>
      <td>7.266829</td>
      <td>6.822990</td>
      <td>0.000000</td>
      <td>1.895749</td>
      <td>5.555556</td>
      <td>10.638639</td>
      <td>30.000000</td>
    </tr>
    <tr>
      <th>NIHSS + Precise + Disability</th>
      <td>131.0</td>
      <td>1.769021</td>
      <td>4.384437</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>33.333333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="violin-plot-of-results">
<h2>Violin plot of results<a class="headerlink" href="#violin-plot-of-results" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="s1">&#39;Ideal&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Age &gt; 80&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NIHSS + Precise&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS + Disability&#39;</span><span class="p">,</span> <span class="s1">&#39;Precise + Disability&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS + Precise + Disability&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="s1">&#39;Ideal</span><span class="se">\n</span><span class="s1">patients&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS&lt;5&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise</span><span class="se">\n</span><span class="s1">onset&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS&gt;2&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&gt;80&#39;</span><span class="p">,</span>
          <span class="s1">&#39;NIHSS +</span><span class="se">\n</span><span class="s1">No precise&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS +</span><span class="se">\n</span><span class="s1">mRS &gt;2&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise +</span><span class="se">\n</span><span class="s1">mRS&gt;2&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS + </span><span class="se">\n</span><span class="s1">No precise +</span><span class="se">\n</span><span class="s1">mRS &gt;2&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">showmedians</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Actual thrombolysis use (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/15a_actual_subgroup_violin.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/15a_observed_thrombolysis_subgroup_analysis_16_0.png" src="../_images/15a_observed_thrombolysis_subgroup_analysis_16_0.png" />
</div>
</div>
</section>
<section id="compare-with-model-results">
<h2>Compare with model results<a class="headerlink" href="#compare-with-model-results" title="Permalink to this headline">#</a></h2>
<p>Model results saved in notebook 15.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./output/15_10k_groups.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span><span class="n">whis</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Actual thrombolysis use (%)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Observed hospital thrombolysis by subgroups</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="s1">&#39;Note: Each hospital has their own patients&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">model_results</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span><span class="n">whis</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted 10k thrombolysis use (%)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predicted 10k thrombolysis by subgroups</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="s1">&#39;Note: Each hospital has the same 10k patients&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/15a_actual_vs_modelled_subgroup_violin.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/15a_observed_thrombolysis_subgroup_analysis_19_0.png" src="../_images/15a_observed_thrombolysis_subgroup_analysis_19_0.png" />
</div>
</div>
<section id="check-correlations-betwen-subgroups">
<h3>Check correlations betwen subgroups<a class="headerlink" href="#check-correlations-betwen-subgroups" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pairs_to_test</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;All patients&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">,</span> <span class="s1">&#39;No precise onset&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;NIHSS &lt; 5&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;No precise onset&#39;</span><span class="p">,</span> <span class="s1">&#39;mRS &gt; 2&#39;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs_to_test</span><span class="p">:</span>
    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> \
        <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">results</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Correlation between </span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">:&#39;</span>
           <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  r-squared = </span><span class="si">{</span><span class="n">r_value</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="s1">, p = </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation between All patients and NIHSS &lt; 5:
  r-squared = 0.661, p = 0.000

Correlation between All patients and No precise onset:
  r-squared = 0.344, p = 0.000

Correlation between All patients and mRS &gt; 2:
  r-squared = 0.528, p = 0.000

Correlation between NIHSS &lt; 5 and No precise onset:
  r-squared = 0.221, p = 0.000

Correlation between NIHSS &lt; 5 and mRS &gt; 2:
  r-squared = 0.308, p = 0.000

Correlation between No precise onset and mRS &gt; 2:
  r-squared = 0.289, p = 0.000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">compare_df</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">],</span> <span class="n">compare_df</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">],</span> 
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># Add best fit</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="n">intercept</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">+</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">slope</span><span class="p">)],</span> 
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted subgroup thrombolysis use (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed subgroup thrombolysis use (%&#39;</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r-squared = </span><span class="si">{</span><span class="n">r_value</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">0.3f</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
    <span class="s1">&#39;Note: predicted and observed</span><span class="se">\n</span><span class="s1">  subgroup patients are different&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/15a_subgroup_correlation.jpg&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">compare_df</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">],</span> <span class="n">compare_df</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">],</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Add best fit</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="n">intercept</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">+</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">slope</span><span class="p">)],</span> 
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;compare_df&#39; is not defined
</pre></div>
</div>
<img alt="../_images/15a_observed_thrombolysis_subgroup_analysis_22_1.png" src="../_images/15a_observed_thrombolysis_subgroup_analysis_22_1.png" />
</div>
</div>
<p>The observed and predicted subgroup analysis show very similar general patterns (with r-sqaured=0.95). Some differences exist:</p>
<ul class="simple">
<li><p>The use of thrombolysi in <em>ideal</em> patients is a little low in the observed vs actual results (mean hopsital thrombolysis use = 89% vs 99%).</p></li>
<li><p>The predicted results show a stronger effect of combining non-ideal features.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./xgb_10_features"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="15_10k_thrombolysis_subgroups.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">A comparison of expected 10k cohort thrombolysis rates across hospitals: subgroup analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="05_compare_benchmark_decisions_key_features.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Compare local thrombolysis decisions with benchmark decisions</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kerry Pearn & Michael Allen<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>