
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Appendix &#8212; Using explainable machine learning to understand variation in thrombolysis practice</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Evaluation of XGBoost learning rates on distribution of 10k thrombolysis rates" href="../xgb_10_features/91_learning_rate_optimisation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Using explainable machine learning to understand variation in thrombolysis practice</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../introduction/intro.html">
                    SAMueL: Summary and key work
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introductory content
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/data.html">
   Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/odds_prob.html">
   Probability, odds, and SHAP values (log odds shifts)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/shap_worked_example.html">
   A simple worked example of Shap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/90_shap_interactions_on_titanic.html">
   Examining interactions between features with SHAP interactions: Using Titanic survival as an example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Predicting thrombolysis use and explaining the predictions with Shap
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/01_xgb_combined_fit_feature_selection.html">
   XGBoost feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/07_correlation.html">
   Check correlation between features selected for the model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/02_xgb_combined_fit_accuracy_key_features.html">
   Measuring accuracy of XGBoost models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/02a_xgb_combined_fit_most_thrombolysable_patients.html">
   An anlysis of the characteristics of the most thrombolysable patient at each hopsital
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/03_xgb_combined_shap_key_features.html">
   Explaining XGBoost model predictions with SHAP values
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Comparing thrombolysis decisions between hospitals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/04_compare_10k_cohort_key_features.html">
   A comparison of 10k cohort thrombolysis rates across hospitals, and comparison with hospital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/15_10k_thrombolysis_subgroups.html">
   A comparison of expected 10k cohort thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/15a_observed_thrombolysis_subgroup_analysis.html">
   A comparison of actual thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/05_compare_benchmark_decisions_key_features.html">
   Compare local thrombolysis decisions with benchmark decisions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/08_xgb_combined_fit_shap_high_vs_low_thrombolysing_units.html">
   Comparing Shap values between high and low thrombolysing hospitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/09_plot_thrombolysis_at_high_vs_low_thrombolysing_units.html">
   Plotting thrombolysis rate by feature value for low and high thrombolysing hopsitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/03c_xgb_shap_values_and_interaction_values_focus_on_ohe_hospitals.html">
   Explaining XGBoost model predictions with SHAP values: Analysis of hopsital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12a_xgb_shap_interactions.html">
   Describing model predictions, using SHAP values and SHAP interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12aa_xgb_shap_interactions_focus_on_onsettime.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Precise Onset Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12ab_xgb_shap_interactions_focus_on_severity.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Stroke Severity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12ac_xgb_shap_interactions_focus_on_disability.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with pre-stroke disability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/20_synthetic_patients.html">
   Investigating the effect of patient features by varying feature values in artificial patients
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/50_bagging_variation.html">
   Evaluating variation in model predictions and predicted 10k thrombolysis rate using bootstrap models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/91_learning_rate_optimisation.html">
   Evaluation of XGBoost learning rates on distribution of 10k thrombolysis rates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Paper (Work In Progress)
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Appendix
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/paper/6_appendix_md.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-access">
     Data access
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-fields">
     Data Fields
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stroke-team">
       Stroke Team
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-general">
       Patient – general
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-pathway-information">
       Patient – pathway information
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-comorbidities">
       Patient – comorbidities
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-nih-stroke-scale">
       Patient – NIH Stroke Scale
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-other-clinical-features">
       Patient – other clinical features
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-thrombolysis-given">
       Patient – thrombolysis given
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-reason-stated-for-not-giving-thrombolysis">
       Patient – reason stated for not giving thrombolysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variation-in-thrombolysis-use">
   Variation in thrombolysis use
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#machine-learning">
   Machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-selection">
   Feature selection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlations-within-the-10-features">
     Correlations within the 10 features
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-accuracy">
   Model accuracy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-of-hospital-thrombolysis-use">
     Validation of hospital thrombolysis use
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-calibration">
     Model calibration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluating-variation-in-model-predictions-and-predicted-10k-cohort-thrombolysis-rate-using-bootstrap-models">
     Evaluating variation in model predictions and predicted 10k cohort thrombolysis rate using bootstrap models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-curves">
     Learning curves
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fine-tuning-of-model-regularisation">
     Fine-tuning of model regularisation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-analysis-of-the-characteristics-of-the-most-thrombolysable-patient-at-each-hospital">
   An analysis of the characteristics of the most thrombolysable patient at each hospital
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explaining-model-predictions-with-shap">
   Explaining model predictions with SHAP
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#probability-odds-and-shap-values-log-odds-shifts-a-brief-explanation">
     Probability, odds, and Shap values (log odds shifts): A brief explanation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#probability">
       Probability
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#odds">
       Odds
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shap-values-log-odds-shifts">
       Shap values: Log odds shifts
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#observations-about-shap-values">
       Observations about Shap values
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consistency-of-shap-values-across-5-fold-validation">
     Consistency of SHAP values across 5-fold validation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beeswarm-plot-of-shap-values">
     Beeswarm plot of SHAP values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#violin-plots-of-shap-values">
     Violin plots of SHAP values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-shap-values">
     Hospital SHAP values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hospital-shap-and-10k-cohort">
       Hospital SHAP and 10k cohort
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#waterfall-plots-for-individual-patient-predictions">
     Waterfall plots for individual patient predictions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hospital-shap-interactions">
   Hospital SHAP interactions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-and-onset-time-interaction">
     Hospital and onset time interaction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-and-stroke-severity-interaction">
     Hospital and stroke severity interaction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Hospital and stroke severity interaction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-shap-interactions">
   General SHAP interactions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subgroup-analysis">
   Subgroup analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-comparison-of-thrombolysis-use-in-high-and-low-thrombolysing-units-by-feature-values">
   A comparison of thrombolysis use in high and low thrombolysing units by feature values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#artificial-patients">
   Artificial patients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-cohort-and-benchmark-decisions">
   10k cohort and
   <em>
    ‘benchmark’
   </em>
   decisions
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Appendix</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-access">
     Data access
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-fields">
     Data Fields
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stroke-team">
       Stroke Team
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-general">
       Patient – general
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-pathway-information">
       Patient – pathway information
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-comorbidities">
       Patient – comorbidities
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-nih-stroke-scale">
       Patient – NIH Stroke Scale
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-other-clinical-features">
       Patient – other clinical features
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-thrombolysis-given">
       Patient – thrombolysis given
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#patient-reason-stated-for-not-giving-thrombolysis">
       Patient – reason stated for not giving thrombolysis
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variation-in-thrombolysis-use">
   Variation in thrombolysis use
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#machine-learning">
   Machine learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-selection">
   Feature selection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlations-within-the-10-features">
     Correlations within the 10 features
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-accuracy">
   Model accuracy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-of-hospital-thrombolysis-use">
     Validation of hospital thrombolysis use
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-calibration">
     Model calibration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluating-variation-in-model-predictions-and-predicted-10k-cohort-thrombolysis-rate-using-bootstrap-models">
     Evaluating variation in model predictions and predicted 10k cohort thrombolysis rate using bootstrap models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-curves">
     Learning curves
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fine-tuning-of-model-regularisation">
     Fine-tuning of model regularisation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#an-analysis-of-the-characteristics-of-the-most-thrombolysable-patient-at-each-hospital">
   An analysis of the characteristics of the most thrombolysable patient at each hospital
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explaining-model-predictions-with-shap">
   Explaining model predictions with SHAP
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#probability-odds-and-shap-values-log-odds-shifts-a-brief-explanation">
     Probability, odds, and Shap values (log odds shifts): A brief explanation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#probability">
       Probability
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#odds">
       Odds
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shap-values-log-odds-shifts">
       Shap values: Log odds shifts
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#observations-about-shap-values">
       Observations about Shap values
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#consistency-of-shap-values-across-5-fold-validation">
     Consistency of SHAP values across 5-fold validation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beeswarm-plot-of-shap-values">
     Beeswarm plot of SHAP values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#violin-plots-of-shap-values">
     Violin plots of SHAP values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-shap-values">
     Hospital SHAP values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#hospital-shap-and-10k-cohort">
       Hospital SHAP and 10k cohort
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#waterfall-plots-for-individual-patient-predictions">
     Waterfall plots for individual patient predictions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hospital-shap-interactions">
   Hospital SHAP interactions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-and-onset-time-interaction">
     Hospital and onset time interaction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hospital-and-stroke-severity-interaction">
     Hospital and stroke severity interaction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Hospital and stroke severity interaction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-shap-interactions">
   General SHAP interactions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subgroup-analysis">
   Subgroup analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-comparison-of-thrombolysis-use-in-high-and-low-thrombolysing-units-by-feature-values">
   A comparison of thrombolysis use in high and low thrombolysing units by feature values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#artificial-patients">
   Artificial patients
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-cohort-and-benchmark-decisions">
   10k cohort and
   <em>
    ‘benchmark’
   </em>
   decisions
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="appendix">
<h1>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">#</a></h1>
<p>For machine learning, our aim was to predict which patients would receive thrombolysis at each hospital. We limit machine learning to patients arriving within 4 hours of known stroke onset (36% of all stroke admissions) as these are the patients who arrive in hospital with time left to administer thrombolysis.</p>
<p>Following features selection of the most influential features, 10 features were used for predictions:</p>
<ul class="simple">
<li><p><em>Arrival-to-scan time</em>: Time from arrival at hospital to scan (mins)</p></li>
<li><p><em>Infarction</em>: Stroke type (1 = infarction, 0 = haemorrhage)</p></li>
<li><p><em>Stroke severity</em>: Stroke severity (NIHSS) on arrival</p></li>
<li><p><em>Precise onset time</em>: Onset time type (1 = precise, 0 = best estimate)</p></li>
<li><p><em>Prior disability level</em>: Disability level (modified Rankin Scale) before stroke</p></li>
<li><p><em>Stroke team</em>: Stroke team attended</p></li>
<li><p><em>Use of AF anticoagulants</em>: Use of atrial fibrillation anticoagulant (1 = Yes, 0 = No)</p></li>
<li><p><em>Onset-to-arrival time</em>: Time from onset of stroke to arrival at hospital (mins)</p></li>
<li><p><em>Onset during sleep</em>: Did stroke occur in sleep?</p></li>
<li><p><em>Age</em>: Age (as middle of 5 year age bands)</p></li>
</ul>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<section id="data-access">
<h3>Data access<a class="headerlink" href="#data-access" title="Permalink to this headline">#</a></h3>
<p>Data was obtained from the Sentinel Stroke National Audit (SSNAP [1]), managed through the Healthcare Quality Improvement Partnership (HQIP [2]). SSNAP has near-complete coverage of all acute stroke admissions in the UK (outside Scotland). All hospitals admitting acute stroke participate in the audit, and year-on-year comparison with Hospital Episode Statistics [3] confirms estimated case ascertainment of 95% of coded cases of acute stroke.</p>
<p>The NHS Health Research Authority decision tool [4] was used to confirm that ethical approval was not required to access the data. Data access was authorised by HQIP (reference HQIP303).</p>
<p>Data was retrieved for 246,676 emergency stroke admissions to acute stroke teams in England and Wales between 2016 and 2018 (three full years). 88,928 patients arrived within 4 hours of known stroke onset.</p>
<p>[1] https://www.strokeaudit.org/</p>
<p>[2] https://www.hqip.org.uk/</p>
<p>[3] https://digital.nhs.uk/data-and-information/data-tools-and-services/data-services/hospital-episode-statistics</p>
<p>[4] http://www.hra-decisiontools.org.uk/research/</p>
</section>
<section id="data-fields">
<h3>Data Fields<a class="headerlink" href="#data-fields" title="Permalink to this headline">#</a></h3>
<section id="stroke-team">
<h4>Stroke Team<a class="headerlink" href="#stroke-team" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>StrokeTeam: Pseudonymised SSNAP ‘routinely admitting team‘ unique identifier. For emergency care it is expected that each hospital has one stroke team (though post-72 hour care may be reported under a different team at that hospital).</p></li>
</ul>
</section>
<section id="patient-general">
<h4>Patient – general<a class="headerlink" href="#patient-general" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Pathway: Total number of team transfers, excluding community teams</p></li>
<li><p>S1AgeOnArrival: Age on arrival aggregated to 5 year bands</p></li>
<li><p>MoreEqual80y: Whether the patient is &gt;= 80 years old at the moment of the stroke</p></li>
<li><p>S1Gender: Gender</p></li>
<li><p>S1Ethnicity: Patient Ethnicity. Aggregated to White, Black, Mixed, Asian and Other</p></li>
</ul>
</section>
<section id="patient-pathway-information">
<h4>Patient – pathway information<a class="headerlink" href="#patient-pathway-information" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>S1OnsetInHospital: Whether the patient was already an inpatient at the time of stroke</p></li>
<li><p>S1OnsetToArrival_min: Time from symptom onset to arrival at hospital in minutes, where known and if out of hospital stroke</p></li>
<li><p>S1OnsetDateType: Whether the date of onset given is precise, best estimate or if the stroke occurred while sleep</p></li>
<li><p>S1OnsetTimeType: Whether the time of symptom onset given is precise, best estimate, not known</p></li>
<li><p>S1ArriveByAmbulance: Whether the patient arrived by ambulance</p></li>
<li><p>S1AdmissionHour: Hour of arrival, aggregates to 3 hour epochs</p></li>
<li><p>S1AdmissionDay: Day of week at the moment of admission</p></li>
<li><p>S1AdmissionQuarter: Year quarter (Q1: Jan-Mar; Q2:April-Jun; Q3: Jul-Sept; Q4: Oct-Dec)</p></li>
<li><p>S1AdmissionYear: Year of admission</p></li>
<li><p>S2BrainImagingTime_min: Time from Clock Start to brain scan. In minutes. “Clock Start” is used throughout SSNAP reporting to refer to the date and time of arrival at first hospital for newly arrived patients, or to the date and time of symptom onset if patient already in hospital at the time of their stroke.</p></li>
<li><p>S2ThrombolysisTime_min: Time from Clock Start to thrombolysis. In minutes. “Clock Start” is used throughout SSNAP reporting to refer to the date and time of arrival at first hospital for newly arrived patients, or to the date and time of symptom onset if patient already in hospital at the time of their stroke.</p></li>
</ul>
</section>
<section id="patient-comorbidities">
<h4>Patient – comorbidities<a class="headerlink" href="#patient-comorbidities" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>CongestiveHeartFailure: Pre-Stroke Congestive Heart Failure</p></li>
<li><p>Hypertension: Pre-Stroke Systemic Hypertension</p></li>
<li><p>AtrialFibrillation: Pre-Stroke Atrial Fibrillation (persistent, permanent, or paroxysmal)</p></li>
<li><p>Diabetes: Comorbidities: Pre-Stroke Diabetes Mellitus</p></li>
<li><p>StrokeTIA: Pre-Stroke history of stroke or Transient Ischaemic Attack (TIA)</p></li>
<li><p>AFAntiplatelet: Only available if “Yes” to Atrial Fibrillation comorbidity. Whether the patient was on antiplatelet medication prior to admission</p></li>
<li><p>AFAnticoagulent: Prior to 01-Dec-2017: Only available if “Yes” to Atrial Fibrillation comorbidity; From 01-Dec-2017: available even if patient is not in Atrial Fibrillation prior to admission. Whether the patient was on anticoagulant medication prior to admission</p></li>
<li><p>AFAnticoagulentVitK: If the patient was receiving anticoagulant medication, was it vitamin K antagonists</p></li>
<li><p>AFAnticoagulentDOAC: If the patient was receiving anticoagulant medication, was it direct oral anticoagulants (DOACs)</p></li>
<li><p>AFAnticoagulentHeparin: If the patient was receiving anticoagulant medication, was it Heparin</p></li>
</ul>
</section>
<section id="patient-nih-stroke-scale">
<h4>Patient – NIH Stroke Scale<a class="headerlink" href="#patient-nih-stroke-scale" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>S2NihssArrival: National Institutes of Health Stroke Scale score on arrival at hospital</p></li>
<li><p>BestGaze: National Institutes of Health Stroke Scale Item 2 Best Gaze (higher values indicate more severe deficit)</p></li>
<li><p>BestLanguage: National Institutes of Health Stroke Scale Item 9 Best Language (higher values indicate more severe deficit)</p></li>
<li><p>Dysarthria: National Institutes of Health Stroke Scale Item 10 Dysarthria (higher values indicate more severe deficit)</p></li>
<li><p>ExtinctionInattention: National Institutes of Health Stroke Scale Item 11 Extinction and Inattention (higher values indicate more severe deficit)</p></li>
<li><p>FacialPalsy: National Institutes of Health Stroke Scale Item 4 Facial Paresis (higher values indicate more severe deficit)</p></li>
<li><p>LimbAtaxia: National Institutes of Health Stroke Scale Item 7 Limb Ataxia (higher values indicate more severe deficit)</p></li>
<li><p>Loc: National Institutes of Health Stroke Scale Item 1a Level of Consciousness (higher values indicate more severe deficit)</p></li>
<li><p>LocCommands: National Institutes of Health Stroke Scale Item 1c Level of Consciousness Commands (higher values indicate more severe deficit)</p></li>
<li><p>LocQuestions: National Institutes of Health Stroke Scale Item 1b Level of Consciousness Questions (higher values indicate more severe deficit)</p></li>
<li><p>MotorArmLeft: National Institutes of Health Stroke Scale Item 5a Motor Arm - Left (higher values indicate more severe deficit)</p></li>
<li><p>MotorArmRight: National Institutes of Health Stroke Scale Item 5b Motor Arm - Right (higher values indicate more severe deficit)</p></li>
<li><p>MotorLegLeft: National Institutes of Health Stroke Scale Item 6a Motor Leg - Left (higher values indicate more severe deficit)</p></li>
<li><p>MotorLegRight: National Institutes of Health Stroke Scale Item 6b Motor Leg - Right (higher values indicate more severe deficit)</p></li>
<li><p>Sensory: National Institutes of Health Stroke Scale Item 8 Sensory (higher values indicate more severe deficit)</p></li>
<li><p>Visual: National Institutes of Health Stroke Scale Item 3 Visual Fields (higher values indicate more severe deficit)</p></li>
</ul>
</section>
<section id="patient-other-clinical-features">
<h4>Patient – other clinical features<a class="headerlink" href="#patient-other-clinical-features" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>S2INR: Patient’s International Normalised ratio (INR) on arrival at hospital (available since 01-Dec-2017)</p></li>
<li><p>S2INRHigh: INR was greater than 10 on arrival at hospital (available since 01-Dec-2017)</p></li>
<li><p>S2INRNK: INR not checked (available since 01-Dec-2017)</p></li>
<li><p>S2NewAFDiagnosis: Whether a new diagnosis of Atrial Fibrillation was made on admission</p></li>
<li><p>S2RankinBeforeStroke: Patient’s modified Rankin Scale score before this stroke (Higher values indicate more disability)</p></li>
<li><p>S2StrokeType: Whether the stroke type was infarction or primary intracerebral haemorrhage</p></li>
<li><p>S2TIAInLastMonth: Whether the patient had a Transient Ischaemic Attack during the last month. Item from the SSNAP comprehensive dataset questions (not mandatory)</p></li>
</ul>
</section>
<section id="patient-thrombolysis-given">
<h4>Patient – thrombolysis given<a class="headerlink" href="#patient-thrombolysis-given" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>S2Thrombolysis: Whether the patient was given thrombolysis (clot busting medication)</p></li>
</ul>
</section>
<section id="patient-reason-stated-for-not-giving-thrombolysis">
<h4>Patient – reason stated for not giving thrombolysis<a class="headerlink" href="#patient-reason-stated-for-not-giving-thrombolysis" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>Age: If the answer to thrombolysis given was “no but”, the reason was Age</p></li>
<li><p>Comorbidity: If the answer to thrombolysis given was “no but”, the reason was Co-morbidity</p></li>
<li><p>Haemorrhagic: If the answer to thrombolysis given was “no but”, the reason was Haemorrhagic stroke</p></li>
<li><p>Improving: If the answer to thrombolysis given was “no but”, the reason was Symptoms Improving</p></li>
<li><p>Medication: If the answer to thrombolysis given was “no but”, the reason was Medication</p></li>
<li><p>OtherMedical: If the answer to thrombolysis given was “no but”, the reason was Other medical reason</p></li>
<li><p>Refusal: If the answer to thrombolysis given was “no but”, the reason was Refusal</p></li>
<li><p>TimeUnknownWakeUp: If the answer to thrombolysis given was “no but”, the reason was Symptom onset time unknown/wake-up stroke</p></li>
<li><p>TimeWindow: If the answer to thrombolysis given was “no but”, the reason was Age</p></li>
<li><p>TooMildSevere: If the answer to thrombolysis given was “no but”, the reason was Stroke too mild or too severe</p></li>
</ul>
</section>
</section>
</section>
<section id="variation-in-thrombolysis-use">
<h2>Variation in thrombolysis use<a class="headerlink" href="#variation-in-thrombolysis-use" title="Permalink to this headline">#</a></h2>
<p>Thrombolysis use varies between hospitals, from 1.5% to 24.3% of all patients, and 7.3% to 49.7% of patients arriving within 4 hours of known stroke onset.</p>
<a class="reference internal image-reference" href="../_images/thrombolysis_hist.jpg"><img alt="../_images/thrombolysis_hist.jpg" src="../_images/thrombolysis_hist.jpg" style="width: 800px;" /></a>
</section>
<section id="machine-learning">
<h2>Machine learning<a class="headerlink" href="#machine-learning" title="Permalink to this headline">#</a></h2>
<p>All work was conducted in Python (v3.8). All code is available at: https://github.com/samuel-book/samuel_shap_paper_1</p>
<p>Our machine learning model used XGBoost (<em>eXtreme Gradient Boosting</em>, v1.5, Chen &amp; Guestrin, 2016). We used default settings apart from <em>learning rate</em> was set at 0.5 (see section below on <em>‘Fine-tuning of model regularisation’</em>.</p>
<p>Machine learning models were explained using SHAP (<em>SHapley Additive exPlanations</em>, v0.41, Lundberg &amp; Lee, 2017).</p>
<p>Chen, T. &amp; Guestrin, C., 2016. XGBoost: A Scalable Tree Boosting System. In Proceedings of the 22nd ACM SIGKDD International Conference on Knowledge Discovery and Data Mining. KDD ‘16. New York, NY, USA: ACM, pp. 785–794. Available at: http://doi.acm.org/10.1145/2939672.2939785.</p>
<p>Lundberg SM, Lee SI. A Unified Approach to Interpreting Model Predictions. In: Advances in Neural Information Processing Systems [Internet]. Curran Associates, Inc.; 2017 [cited 2022 Jun 17]. Available from: https://proceedings.neurips.cc/paper/2017/hash/8a20a8621978632d76c43dfd28b67767-Abstract.html</p>
</section>
<section id="feature-selection">
<h2>Feature selection<a class="headerlink" href="#feature-selection" title="Permalink to this headline">#</a></h2>
<p>25 features were selected by identifying one feature at a time that led to greatest improvement in Receiver Operating Characteristic (ROC) Area Under Curve (AUC). ROC AUC was measured using stratified 5-fold cross validation.</p>
<p>The best model with 1, 2, 5, 10, 25 &amp; all features (60 features before one-hot encoding of fields) had ROC AUCs of 0.715, 0.792, 0.891, 0.919, 0.923 &amp; 0.922. We selected 10 features for all subsequent work, which were:</p>
<ul class="simple">
<li><p><em>Arrival-to-scan time</em>: Time from arrival at hospital to scan (mins)</p></li>
<li><p><em>Infarction</em>: Stroke type (1 = infarction, 0 = haemorrhage)</p></li>
<li><p><em>Stroke severity</em>: Stroke severity (NIHSS) on arrival</p></li>
<li><p><em>Precise onset time</em>: Onset time type (1 = precise, 0 = best estimate)</p></li>
<li><p><em>Prior disability level</em>: Disability level (modified Rankin Scale) before stroke</p></li>
<li><p><em>Stroke team</em>: Stroke team attended</p></li>
<li><p><em>Use of AF anticoagulants</em>: Use of atrial fibrillation anticoagulant (1 = Yes, 0 = No)</p></li>
<li><p><em>Onset-to-arrival time</em>: Time from onset of stroke to arrival at hospital (mins)</p></li>
<li><p><em>Onset during sleep</em>: Did stroke occur in sleep?</p></li>
<li><p><em>Age</em>: Age (as middle of 5 year age bands)</p></li>
</ul>
<p>The improvement in ROC AUC with increasing features is shown in the figure below.</p>
<a class="reference internal image-reference" href="../_images/01_feature_selection.jpg"><img alt="../_images/01_feature_selection.jpg" src="../_images/01_feature_selection.jpg" style="width: 800px;" /></a>
<p><em>The effect of increasing the number of features on model accuracy measured by Receiver Operating Characteristic (ROC) Area Under Curve (AUC). Left: Improvement with ROC AUC with selection of up to 25 features. Right: Improvement with ROC AUC with selection of the best 10 features.</em></p>
<section id="correlations-within-the-10-features">
<h3>Correlations within the 10 features<a class="headerlink" href="#correlations-within-the-10-features" title="Permalink to this headline">#</a></h3>
<p>Correlations between the 10 features were measured using coefficients of determination (r-squared). All r-squared were less than 0.15, and all r-squared were less than 0.05 except 1) age and prior disability level (r-squared 0.146), and 2) onset during sleep and precise onset time (r-squared 0.078).</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>variable 1</p></th>
<th class="text-align:right head"><p>Variable 2</p></th>
<th class="text-align:right head"><p>r-squared</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>0.1462</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>0.0784</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>0.0454</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>0.0386</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>0.0344</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>0.0268</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>0.0207</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>0.0186</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>0.0131</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>0.0090</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>0.0070</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>0.0043</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>0.0038</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>0.0033</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>0.0022</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>0.0021</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>0.0019</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>0.0019</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>0.0016</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>0.0011</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>0.0007</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>0.0007</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>0.0006</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>0.0004</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>0.0001</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Onset-to-arrival time</p></td>
<td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>0.0001</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Stroke severity</p></td>
<td class="text-align:right"><p>Precise onset time</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Use of AF anticoagulants</p></td>
<td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Arrival-to-scan time</p></td>
<td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>Age</p></td>
<td class="text-align:right"><p>Onset during sleep</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>Prior disability level</p></td>
<td class="text-align:right"><p>Infarction</p></td>
<td class="text-align:right"><p>0.0000</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="model-accuracy">
<h2>Model accuracy<a class="headerlink" href="#model-accuracy" title="Permalink to this headline">#</a></h2>
<p>Model accuracy was measured using stratified 5-fold cross validation. The key results are shown below.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>measurement</p></th>
<th class="head"><p>mean</p></th>
<th class="head"><p>std</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>actual positive rate</p></td>
<td><p>0.296</p></td>
<td><p>0.000</p></td>
</tr>
<tr class="row-odd"><td><p>actual negative rate</p></td>
<td><p>0.704</p></td>
<td><p>0.000</p></td>
</tr>
<tr class="row-even"><td><p>predicted positive rate</p></td>
<td><p>0.294</p></td>
<td><p>0.002</p></td>
</tr>
<tr class="row-odd"><td><p>predicted negative rate</p></td>
<td><p>0.706</p></td>
<td><p>0.002</p></td>
</tr>
<tr class="row-even"><td><p>accuracy</p></td>
<td><p>0.850</p></td>
<td><p>0.004</p></td>
</tr>
<tr class="row-odd"><td><p>sensitivity (recall)</p></td>
<td><p>0.743</p></td>
<td><p>0.004</p></td>
</tr>
<tr class="row-even"><td><p>specificity</p></td>
<td><p>0.894</p></td>
<td><p>0.004</p></td>
</tr>
<tr class="row-odd"><td><p>precision</p></td>
<td><p>0.747</p></td>
<td><p>0.007</p></td>
</tr>
<tr class="row-even"><td><p>ROC AUC</p></td>
<td><p>0.918</p></td>
<td><p>0.003</p></td>
</tr>
<tr class="row-odd"><td><p>Balanced sensitivity/specificity</p></td>
<td><p>0.839</p></td>
<td><p>0.003</p></td>
</tr>
</tbody>
</table>
<p>The figure below shows the receiver operating characteristic curve, along with the trade-off between sensitivity and specificity.</p>
<a class="reference internal image-reference" href="../_images/02_xgb_10_features_roc_sens_spec.jpg"><img alt="../_images/02_xgb_10_features_roc_sens_spec.jpg" src="../_images/02_xgb_10_features_roc_sens_spec.jpg" style="width: 800px;" /></a>
<section id="validation-of-hospital-thrombolysis-use">
<h3>Validation of hospital thrombolysis use<a class="headerlink" href="#validation-of-hospital-thrombolysis-use" title="Permalink to this headline">#</a></h3>
<p>With k-fold validation, every instance is in one, but only one, test set. The test sets may therefore be combined to have predictions for the whole data set. Using these collated results we may compare predicted thrombolysis use at each hospital, compared with the actual (observed) thrombolysis use. There was very good agreement between predicted and observed thrombolysis use at each hospital (r-squared 0.977).</p>
<a class="reference internal image-reference" href="../_images/02_xgb_10_features_observed_predicted_rates.jpg"><img alt="../_images/02_xgb_10_features_observed_predicted_rates.jpg" src="../_images/02_xgb_10_features_observed_predicted_rates.jpg" style="width: 500px;" /></a>
</section>
<section id="model-calibration">
<h3>Model calibration<a class="headerlink" href="#model-calibration" title="Permalink to this headline">#</a></h3>
<p>The model calibration was checked by binning predictions by probability, and comparing the mean predicted probability with the fraction that were actually positive. This demonstrates that the model was naturally well-calibrated, and was not in need of any calibration correction.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>bin</p></th>
<th class="head"><p>predicted probability</p></th>
<th class="head"><p>fraction positive</p></th>
<th class="head"><p>fraction correct</p></th>
<th class="head"><p>frequency</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.1</p></td>
<td><p>0.018</p></td>
<td><p>0.023</p></td>
<td><p>0.977</p></td>
<td><p>0.480</p></td>
</tr>
<tr class="row-odd"><td><p>0.2</p></td>
<td><p>0.146</p></td>
<td><p>0.174</p></td>
<td><p>0.826</p></td>
<td><p>0.082</p></td>
</tr>
<tr class="row-even"><td><p>0.3</p></td>
<td><p>0.248</p></td>
<td><p>0.271</p></td>
<td><p>0.729</p></td>
<td><p>0.056</p></td>
</tr>
<tr class="row-odd"><td><p>0.4</p></td>
<td><p>0.348</p></td>
<td><p>0.371</p></td>
<td><p>0.629</p></td>
<td><p>0.045</p></td>
</tr>
<tr class="row-even"><td><p>0.5</p></td>
<td><p>0.450</p></td>
<td><p>0.443</p></td>
<td><p>0.557</p></td>
<td><p>0.043</p></td>
</tr>
<tr class="row-odd"><td><p>0.6</p></td>
<td><p>0.551</p></td>
<td><p>0.546</p></td>
<td><p>0.546</p></td>
<td><p>0.042</p></td>
</tr>
<tr class="row-even"><td><p>0.7</p></td>
<td><p>0.652</p></td>
<td><p>0.643</p></td>
<td><p>0.643</p></td>
<td><p>0.049</p></td>
</tr>
<tr class="row-odd"><td><p>0.8</p></td>
<td><p>0.753</p></td>
<td><p>0.736</p></td>
<td><p>0.736</p></td>
<td><p>0.065</p></td>
</tr>
<tr class="row-even"><td><p>0.9</p></td>
<td><p>0.852</p></td>
<td><p>0.827</p></td>
<td><p>0.827</p></td>
<td><p>0.089</p></td>
</tr>
<tr class="row-odd"><td><p>1.0</p></td>
<td><p>0.932</p></td>
<td><p>0.893</p></td>
<td><p>0.893</p></td>
<td><p>0.049</p></td>
</tr>
</tbody>
</table>
<a class="reference internal image-reference" href="../_images/02_xgb_10_features_reliability.jpg"><img alt="../_images/02_xgb_10_features_reliability.jpg" src="../_images/02_xgb_10_features_reliability.jpg" style="width: 800px;" /></a>
</section>
<section id="evaluating-variation-in-model-predictions-and-predicted-10k-cohort-thrombolysis-rate-using-bootstrap-models">
<h3>Evaluating variation in model predictions and predicted 10k cohort thrombolysis rate using bootstrap models<a class="headerlink" href="#evaluating-variation-in-model-predictions-and-predicted-10k-cohort-thrombolysis-rate-using-bootstrap-models" title="Permalink to this headline">#</a></h3>
<p>Data was split into a training set of 78,928 patients, and a test set of 10k patients. 30 models were trained, each with a different bootstrap sample of the training set and with a different model random seed. For each of the 10k test set, we evaluated the variation in the predicted probability of receiving thrombolysis. The mean of these standard deviation was 0.057, but the variation depended on the probability, with variation peaking at about 0.13 when the prediction probability of receiving thrombolysis was around 0.5.</p>
<a class="reference internal image-reference" href="../_images/50_bootstrap_prediction_sd.jpg"><img alt="../_images/50_bootstrap_prediction_sd.jpg" src="../_images/50_bootstrap_prediction_sd.jpg" style="width: 500px;" /></a>
<p>Additionally, we used the models and test set to predict thrombolysis at each of the 132 hospitals if the 10k cohort of patients had attended each of the hospitals (by changing the hospital one-hot encoding). We predicted the thrombolysis use at each hospital, and examined the variation between the 30 bootstrapped models. The mean of the standard deviation of bootstrap replicates was 1.7% (where hospital thrombolysis use rates were 10% to 45%).</p>
<a class="reference internal image-reference" href="../_images/50_bootstrap_10k_sd.jpg"><img alt="../_images/50_bootstrap_10k_sd.jpg" src="../_images/50_bootstrap_10k_sd.jpg" style="width: 800px;" /></a>
<p>Bagging experiments were repeated with <em>Baysian Bootstrapping</em> based on weighting training samples using a Dirichlet distribution. Very similar results were achieved, with a mean standard deviation of bootstrap replicate probability predictions of 0.054, and a mean standard deviation of bootstrap replicate 10k thrombolysis use in hospitals of 1.6%.</p>
<p>The evaluation of bootstrapped replicates gave us confidence that a single model fit would be sufficient.</p>
</section>
<section id="learning-curves">
<h3>Learning curves<a class="headerlink" href="#learning-curves" title="Permalink to this headline">#</a></h3>
<p>Learning curves were performed using stratified 5-fold validation, and by random sampling of the training set. The maximum accuracy achieved was 85% using 70k trainign points, 82.5% accuracy was achieved with 4k training points. There was a shallow improvement between 4k and 70k training points.</p>
<a class="reference internal image-reference" href="../_images/02_xgb_10_features_learning_curve.jpg"><img alt="../_images/02_xgb_10_features_learning_curve.jpg" src="../_images/02_xgb_10_features_learning_curve.jpg" style="width: 800px;" /></a>
</section>
<section id="fine-tuning-of-model-regularisation">
<h3>Fine-tuning of model regularisation<a class="headerlink" href="#fine-tuning-of-model-regularisation" title="Permalink to this headline">#</a></h3>
<p>As hospital ID is encoded as one-hot, and there are 132 hospitals, it is possible that the effect of hospitals ID becomes ‘regularised out’. <em>Learning rate</em> in XGBoost acts as a regulariser. The lower the learning rate the less weight new trees have, and so the model becomes more regularised (less likely to overfit).</p>
<p>As we are concerned with differences between hospitals, we did not want to over-regularise the model. To optimise <em>learning rate</em> we looked at the between-hospital variation of predicted thrombolysis use in a 10k cohort of patients (with the model predicting the use of thrombolysis in each hospital with the same 10k cohort). The mode was trained was on the remain 78,928 patients, with varying learning rates.</p>
<p>Reducing the learning rate below 0.5 led to reduced between-hospital variation in the predicted use of thrombolysis, suggesting that the effect of hospital ID was being reduced by over-regularisation.</p>
<p>A learning rate of 0.5 was chosen for all modelling (including the accuracy measurements above).</p>
<a class="reference internal image-reference" href="../_images/91_learning_rate.jpg"><img alt="../_images/91_learning_rate.jpg" src="../_images/91_learning_rate.jpg" style="width: 400px;" /></a>
</section>
</section>
<section id="an-analysis-of-the-characteristics-of-the-most-thrombolysable-patient-at-each-hospital">
<h2>An analysis of the characteristics of the most thrombolysable patient at each hospital<a class="headerlink" href="#an-analysis-of-the-characteristics-of-the-most-thrombolysable-patient-at-each-hospital" title="Permalink to this headline">#</a></h2>
<p>We identified the patient with the highest probability of thrombolysis at each hospital, and compared the feature values of those patients to:</p>
<ul class="simple">
<li><p>All patients</p></li>
<li><p>All patients receiving thrombolysis</p></li>
<li><p>All patients not receiving thrombolysis</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/02a_most_thrombolsyable_violin.jpg"><img alt="../_images/02a_most_thrombolsyable_violin.jpg" src="../_images/02a_most_thrombolsyable_violin.jpg" style="width: 800px;" /></a>
<p>Compared with the other groups, the most thrombolysable patients ….</p>
<ul class="simple">
<li><p>Had shorter arrrival-to-scan times</p></li>
<li><p>Had an infarction stroke type</p></li>
<li><p>Had stroke servities with NIHR 5-25</p></li>
<li><p>Had a precise onset time</p></li>
<li><p>Had lower pre-stroke disability</p></li>
<li><p>Were not taking anticoagulant medication</p></li>
<li><p>Had shorter onset-to-arrival times</p></li>
<li><p>Do not have onset during sleep</p></li>
<li><p>Were younger</p></li>
</ul>
</section>
<section id="explaining-model-predictions-with-shap">
<h2>Explaining model predictions with SHAP<a class="headerlink" href="#explaining-model-predictions-with-shap" title="Permalink to this headline">#</a></h2>
<p>SHAP values describe how much a feature affects the probability of receiving thrombolysis. These are usually expressed as log odds. Below is a brief introduction to probability, odds, log odds and SHAP values.</p>
<section id="probability-odds-and-shap-values-log-odds-shifts-a-brief-explanation">
<h3>Probability, odds, and Shap values (log odds shifts): A brief explanation<a class="headerlink" href="#probability-odds-and-shap-values-log-odds-shifts-a-brief-explanation" title="Permalink to this headline">#</a></h3>
<p>Many of us find it easiest to think of the chance of something occurring as a probability. For example, there might be a probability of 10% that it will rain today. That is the same as saying there will be one rainy day out of ten days for days with this given probability of rain.</p>
<p>In our stroke thrombolysis model, Shap values tell us how knowing something particular about a patient (such as the patient <em>feature</em>, ‘Is their stroke caused by a clot or a bleed?’) adjusts our prediction of whether they will receive thrombolysis or not.</p>
<p>This is made a little more complicated for us because Shap is usually reported as a <em>log odds shift</em>. It is useful for us to see how those relate to probabilities, and get a sense of how significant Shap values in the range of 0.5 to 5 (or -0.5 to -5) are, as that is a common range of Shap values that we will see in our models.</p>
<section id="probability">
<h4>Probability<a class="headerlink" href="#probability" title="Permalink to this headline">#</a></h4>
<p>We will take the example that Shap reports that a model’s base probability prediction, before the contribution of features is 0.25, or a 25% probability of receiving thrombolysis; that is 1 in 4 patients with this prediction would be expected to receive thrombolysis.</p>
</section>
<section id="odds">
<h4>Odds<a class="headerlink" href="#odds" title="Permalink to this headline">#</a></h4>
<p><em>Probability</em> expresses the chance of something happening as the number of positive occurrences as a fraction of all occurrences (i.e. the number of patients receiving thrombolysis as a fraction of the total number of patients).</p>
<p><em>Odds</em> express the chance of something happening as the ratio of the number of positive occurrences (i.e. receiving thrombolysis) to the number of negative occurrences (i.e. <em>not</em> receiving thrombolysis).</p>
<p>If we have probability prediction of 0.25 would receive thrombolysis, that would mean 1 in 4 of those patients receive thrombolysis. Expressed as odds, for every one patient that receives thrombolysis, three will not. The odds are expressed as 1:3 or 1/3. This may also be calculated as a decimal (1 divided by 3), 0.333.</p>
<p>Odds (O) and probability (P) may be converted with the following equations:</p>
<ol class="simple">
<li><p>O = P / (1 - P)</p></li>
<li><p>P = O / (1 + O)</p></li>
</ol>
</section>
<section id="shap-values-log-odds-shifts">
<h4>Shap values: Log odds shifts<a class="headerlink" href="#shap-values-log-odds-shifts" title="Permalink to this headline">#</a></h4>
<p>Here we will calculate the effect of Shap values, and try and build some intuition on the size of effect Shap values of 0.5 to 5 give (we will look at positive and negative Shap values).</p>
<p>Shap usually outputs the effect of a particular feature in how much it shifts the odds. For reasons we will not go into here, that shift (which is the ‘Shap value’) is usually given in ‘log odds’ (the logarithm of the odds value). For the mathematically inclined, we use the natural log (<em>ln</em>).</p>
<p>Let’s look at some Shap values (log odds) and see how much they change the odds of receiving thrombolysis.</p>
<p>First we’ll look at the shift in odds the Shap values give. This is calculated as <em>shift = exp(Shap)</em></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Shap (log odds)</p></th>
<th class="head"><p>Shift in odds (multiply original odds)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.5</p></td>
<td><p>1.65</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2.72</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>7.39</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>20.1</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>54.6</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>148</p></td>
</tr>
</tbody>
</table>
<p><em>Positive Shap values: worked example</em></p>
<p>Now let us work through an example of starting with a known baseline <em>probability</em> (before we consider what we know about a particular patient feature), converting that to <em>odds</em>, applying a Shap <em>log odds shift</em> for that particular feature, and converting back to <em>probability</em> after we have applied the influence of that feature.</p>
<p>Here are the effects of those shifts on our baseline probability of 0.25.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Starting P</p></th>
<th class="head"><p>Starting O</p></th>
<th class="head"><p>SHAP</p></th>
<th class="head"><p>Shift (multiply O)</p></th>
<th class="head"><p>Shifted O</p></th>
<th class="head"><p>Shifted P (%)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>0.5</p></td>
<td><p>1.65</p></td>
<td><p>0.55</p></td>
<td><p>0.3547 (35.5%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>1</p></td>
<td><p>2.72</p></td>
<td><p>0.907</p></td>
<td><p>0.4754 (47.5%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>2</p></td>
<td><p>7.39</p></td>
<td><p>2.46</p></td>
<td><p>0.7112 (71.1%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>3</p></td>
<td><p>20.1</p></td>
<td><p>6.7</p></td>
<td><p>0.87 (87.0%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>4</p></td>
<td><p>54.6</p></td>
<td><p>18.2</p></td>
<td><p>0.9479 (94.8%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>5</p></td>
<td><p>148</p></td>
<td><p>49.5</p></td>
<td><p>0.9802 (98.0%)</p></td>
</tr>
</tbody>
</table>
<p>So, for example, a Shap value of 0.5 for one particular feature tells us that that particular feature in that patient shifts our expected probability of that patient receiving thrombolysis from 25% to 36%. A Shap value of 5 for the same feature would shift the probability of that patient receiving thrombolysis up to 98%.</p>
<p><em>Negative Shap values: worked example</em></p>
<p>If we have a negative Shap value then odds are reduced (a Shap of -1 will lead to the odds being divided by 2.72, which is the same as multiplying by 1/2.72, which is 0.3679):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Starting P</p></th>
<th class="head"><p>Starting O</p></th>
<th class="head"><p>SHAP</p></th>
<th class="head"><p>Shift (multiply O)</p></th>
<th class="head"><p>Shifted O</p></th>
<th class="head"><p>Shifted P (%)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-0.5</p></td>
<td><p>1.65</p></td>
<td><p>0.55</p></td>
<td><p>0.1682 (16.8%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-1</p></td>
<td><p>2.72</p></td>
<td><p>0.907</p></td>
<td><p>0.1092 (10.9%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-2</p></td>
<td><p>7.39</p></td>
<td><p>2.46</p></td>
<td><p>0.0432 (4.32%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-3</p></td>
<td><p>20.1</p></td>
<td><p>6.7</p></td>
<td><p>0.0163 (1.63%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-4</p></td>
<td><p>54.6</p></td>
<td><p>18.2</p></td>
<td><p>0.0061 (0.61%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-5</p></td>
<td><p>148</p></td>
<td><p>49.5</p></td>
<td><p>0.0022 (0.22%)</p></td>
</tr>
</tbody>
</table>
<p>So, for example, a Shap value of -0.5 for one particular feature tells us that that particular feature in that patient shifts our expected probability of that patient receiving thrombolysis from 25% to 17%. A Shap value of 5 for the same feature would shift the probability of that patient receiving thrombolysis down to 2%.</p>
</section>
<section id="observations-about-shap-values">
<h4>Observations about Shap values<a class="headerlink" href="#observations-about-shap-values" title="Permalink to this headline">#</a></h4>
<p>We begin to get some intuition on Shap values. A Shap value of 0.5 (or -0.5) leads to a small, but still noticeable, change in probability. Shap values of 5 or -5 have effectively pushed probabilities to one extreme or the other.</p>
</section>
</section>
<section id="consistency-of-shap-values-across-5-fold-validation">
<h3>Consistency of SHAP values across 5-fold validation<a class="headerlink" href="#consistency-of-shap-values-across-5-fold-validation" title="Permalink to this headline">#</a></h3>
<p>The figure below shows the variation in mean absolute SHAP values obtained from the training sets of the 5 models in k-fold validation. SHAP values are well maintained across the five models.</p>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_shap_violin.jpg"><img alt="../_images/03_xgb_10_features_shap_violin.jpg" src="../_images/03_xgb_10_features_shap_violin.jpg" style="width: 400px;" /></a>
<p>This result gave us confidence to use a single train/split to further investigate what SHAP reveals about the model.</p>
<p>We also see the order of general influence of features across the population (note: teams are separated out into individual features, and need a separate analysis to examine SHAP of only those patients attending a particular hospital, as otherwise the SHAP is dominated by all the ‘0’ one-hot encoded feature values):</p>
<ol class="simple">
<li><p>Infarction</p></li>
<li><p>Arrival-to-scan time</p></li>
<li><p>Stroke severity</p></li>
<li><p>Precise onset time</p></li>
<li><p>Prior disability level</p></li>
<li><p>Use of AF anticoagulants</p></li>
<li><p>Onset-to-arrival time</p></li>
<li><p>Age</p></li>
<li><p>Onset during sleep</p></li>
</ol>
</section>
<section id="beeswarm-plot-of-shap-values">
<h3>Beeswarm plot of SHAP values<a class="headerlink" href="#beeswarm-plot-of-shap-values" title="Permalink to this headline">#</a></h3>
<p>The <em>beeswarm</em> plot gives a high level view of the feature values and SHAP values across the whole data set. We can see, for example that if a patient has an infarction then SHAP values are in the range 1-2, but if the patient does not have an infarction (i.e. has a haemorrhage) then SHAP values are in the range -8 to -4, effectively preventing the model from ever predicting thrombolysis would be given to a haemorrhagic patient.</p>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_beeswarm.jpg"><img alt="../_images/03_xgb_10_features_beeswarm.jpg" src="../_images/03_xgb_10_features_beeswarm.jpg" style="width: 600px;" /></a>
</section>
<section id="violin-plots-of-shap-values">
<h3>Violin plots of SHAP values<a class="headerlink" href="#violin-plots-of-shap-values" title="Permalink to this headline">#</a></h3>
<p>Violin plots show the relationship between feature values and SHAP values for individual patients (the bar in each violin shows the median value). Key observations are:</p>
<ul class="simple">
<li><p>Stroke type: As expected,  the SHAP values for stroke types effectively eliminated any chance of receiving thrombolysis for non-ischaemic (haemorrhagic) stroke.</p></li>
<li><p>Arrival-to-scan time: The odds of receiving thrombolysis reduced by about 20 fold over the first 100 minutes of arrival to scan time.</p></li>
<li><p>Stroke severity (NIHSS): The odds of receiving thrombolysis was lowest at NIHSS 0, rose and peakws at NIHSS 15-25, and then fell again with higher stroke severity. The difference between minimum odds (at NIHSS 0) and maximum odds (at 15-25) of receiving thrombolysis was 30-35 fold.</p></li>
<li><p>Stroke onset time type (precise vs. estimated): The odds of receiving thrombolysis were about 3 fold greater for precise onset time than estimated onset time.</p></li>
<li><p>Disability level (Rankin) before stroke. The odds of receiving thrombolysis fell about 5 fold between mRS 0 and 5.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_thrombolysis_shap_violin.jpg"><img alt="../_images/03_xgb_10_features_thrombolysis_shap_violin.jpg" src="../_images/03_xgb_10_features_thrombolysis_shap_violin.jpg" style="width: 800px;" /></a>
</section>
<section id="hospital-shap-values">
<h3>Hospital SHAP values<a class="headerlink" href="#hospital-shap-values" title="Permalink to this headline">#</a></h3>
<p>When examining SHAP, we take the hospital SHAP values for patients attending each hospital (if we examined the hospital SHAP for all patients, it would be dominated by those not-attending each hospital (i.e. coded zero in the one-hot encoding). When we examine the hospital SHAP values for a model trained on all the data, and only for patients attending each hospital, the hospital SHAP values ranged from -1.4 to +1.4. This range of SHAP (log odds) represents a 15 fold difference in odds of receiving thrombolysis (most are in the range of -1 to +1, but this still represents a 7-8 fold difference in odds of receiving thrombolysis).</p>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_hosp_shap_hist.jpg"><img alt="../_images/03_xgb_10_features_hosp_shap_hist.jpg" src="../_images/03_xgb_10_features_hosp_shap_hist.jpg" style="width: 400px;" /></a>
<p>We compared the hospital SHAP value with the observed thrombolysis use at each hospital. Hospital SHAP correlated with observed thrombolysis rate with an r-squared of 0.582 (P&lt;0.0001) , suggesting that 58% of the between-hospital variance in thrombolysis use may be explained by the hospitals’ SHAP values, that is the hospitals’ predisposition to use thrombolysis.</p>
<a class="reference internal image-reference" href="../_images/03c_xgb_10_features_attended_hosp_shap_value.jpg"><img alt="../_images/03c_xgb_10_features_attended_hosp_shap_value.jpg" src="../_images/03c_xgb_10_features_attended_hosp_shap_value.jpg" style="width: 400px;" /></a>
<p>The hospital SHAP value is composed of a <em>main</em> effect of the hospital, independent of other patient features, and <em>interaction effects</em>, which is how the hospital ID interacts with other patient features (e.g. if a hospital treats a certain type of patient in a way that is different to the usual pattern). We found that the SHAP value (which is the sum of the <em>main effect</em> and the <em>interaction effects</em>) for hospitals had a broader range than the main effect, as this value included how a hospital may have different predispositions to use thrombolysis in different types of patient.</p>
<a class="reference internal image-reference" href="../_images/03c_xgb_10_features_individual_hosp_shap_value_and_main_effect_attend_vs_notattend_boxplot.jpg"><img alt="../_images/03c_xgb_10_features_individual_hosp_shap_value_and_main_effect_attend_vs_notattend_boxplot.jpg" src="../_images/03c_xgb_10_features_individual_hosp_shap_value_and_main_effect_attend_vs_notattend_boxplot.jpg" style="width: 800px;" /></a>
<p>When we re-axamine the correlation between hospital SHAP and observed thrombolysis rate, we find that the main hospital SHAP effect accounts for 56% of the variance in thrombolysis rate (<em>c.f.</em> 58% for the full SHAP).</p>
<a class="reference internal image-reference" href="../_images/03c_xgb_10_features_attended_hosp_shap_value_and_main_effect_vs_ivt_rate.jpg"><img alt="../_images/03c_xgb_10_features_attended_hosp_shap_value_and_main_effect_vs_ivt_rate.jpg" src="../_images/03c_xgb_10_features_attended_hosp_shap_value_and_main_effect_vs_ivt_rate.jpg" style="width: 500px;" /></a>
<section id="hospital-shap-and-10k-cohort">
<h4>Hospital SHAP and 10k cohort<a class="headerlink" href="#hospital-shap-and-10k-cohort" title="Permalink to this headline">#</a></h4>
<p>When using the 10k cohort, changing the one-hot encoding to mimic all patients attending each of the 132 hospitals, we found that the median hospital SHAP value for the 10k patients correlated very closely with the predicted thrombolysis use in the 10k cohort at each hospital (r-squared = 0.947 for full SHAP and r-squared = 0.944 for the main effect), confirming that the hospital SHAP is providing a key insight into a hopsital’s predisposition to use thrombolysis.</p>
<a class="reference internal image-reference" href="../_images/04_xgb_10_features_10k_cohort_attended_hosp_shap.jpg"><img alt="../_images/04_xgb_10_features_10k_cohort_attended_hosp_shap.jpg" src="../_images/04_xgb_10_features_10k_cohort_attended_hosp_shap.jpg" style="width: 400px;" /></a>
<p>Though we model the same 10k patients going to all hospitals, we found that the SHAP interaction effect (the difference between the full SAHP value and the SHAP main effect) differed between hospitals. This demonstrated how the hospital SHAP is partly dependent on the patients attending (and the hospital’s predisposition to give thrombolysis to different groups of patients).</p>
<a class="reference internal image-reference" href="../_images/04_xgb_10_features_10k_cohort_individual_hosp_shap_value_and_maineffect_attend_vs_notattend_boxplot.jpg"><img alt="../_images/04_xgb_10_features_10k_cohort_individual_hosp_shap_value_and_maineffect_attend_vs_notattend_boxplot.jpg" src="../_images/04_xgb_10_features_10k_cohort_individual_hosp_shap_value_and_maineffect_attend_vs_notattend_boxplot.jpg" style="width: 800px;" /></a>
</section>
</section>
<section id="waterfall-plots-for-individual-patient-predictions">
<h3>Waterfall plots for individual patient predictions<a class="headerlink" href="#waterfall-plots-for-individual-patient-predictions" title="Permalink to this headline">#</a></h3>
<p>Waterfall plots show the influence of features for an individual prediction. We generally handle SHAP values as how they affect log odds of receiving thrombolysis, but for individual predictions, probability plots are more intuitive. The example shown below is for a patient with a low probability of receiving thrombolysis. The model starts with a base prediction of a 24% probability of receiving thrombolysis, before feature values are taken into account. Some features increase that base probability of receiving thrombolysis, those are onet-to-arrival time, having a precise onset time, having no prior disability, and being young. Three features then reduce the probability of receiving thrombolysis: the hospital they attended, the long arrival-to-scan time, and having a mild stroke, with a resulting final probability of receiving thrombolysis of 3%.</p>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_waterfall_probability_low.jpg"><img alt="../_images/03_xgb_10_features_waterfall_probability_low.jpg" src="../_images/03_xgb_10_features_waterfall_probability_low.jpg" style="width: 600px;" /></a>
<p>We may see a similar plot for a patient with a high (96%) probability of receiving thrombolysis.</p>
<a class="reference internal image-reference" href="../_images/03_xgb_10_features_waterfall_probability_high.jpg"><img alt="../_images/03_xgb_10_features_waterfall_probability_high.jpg" src="../_images/03_xgb_10_features_waterfall_probability_high.jpg" style="width: 600px;" /></a>
</section>
</section>
<section id="hospital-shap-interactions">
<h2>Hospital SHAP interactions<a class="headerlink" href="#hospital-shap-interactions" title="Permalink to this headline">#</a></h2>
<p>Below are three examples of how a particular hospital modifies the general SHAP effects - either strengthening the effect, of attenuating it.</p>
<section id="hospital-and-onset-time-interaction">
<h3>Hospital and onset time interaction<a class="headerlink" href="#hospital-and-onset-time-interaction" title="Permalink to this headline">#</a></h3>
<p>The main effect of the <em>precise onset time</em> is that if onset time is known precisely then SHAP (log odds) is increased by 0.42, otherwise it is reduced by 0.85.</p>
<p><em>Team_HZNVT9936G</em> has a slightly higher main effect for hopsital SHAP (0.26) than <em>Team_FAJKD7118X -0.27)</em>. <em>Team_HZNVT9936G</em> also has interactions that strengthen the effect of <em>precise onset time</em> whereas <em>Team_FAJKD7118X</em> has interactions values that attenuate the main effect of <em>precise onset time</em>.</p>
<a class="reference internal image-reference" href="../_images/12aa_onset_time_type_interaction_example.jpg"><img alt="../_images/12aa_onset_time_type_interaction_example.jpg" src="../_images/12aa_onset_time_type_interaction_example.jpg" style="width: 600px;" /></a>
</section>
<section id="hospital-and-stroke-severity-interaction">
<h3>Hospital and stroke severity interaction<a class="headerlink" href="#hospital-and-stroke-severity-interaction" title="Permalink to this headline">#</a></h3>
<p>The main effect of stroke severity is to significantly reduce the odds of receiving thrombolysis for mild strokes (NIHSS 0-5), increase the odds of receiving thrombolysis for more moderate to sever strokes (NIHSS 6-32), and then reduce the odds of receiving thrombolysis for very severe stroke strokes (NIHSS 33+).</p>
<p><em>Team_TPXYE0168D</em> has a higher general tendency to use thrombolysis than <em>Team_SMVTP6284P</em> (team main effect SHAP = 0.92 vs 0.62)</p>
<p><em>Team_TPXYE0168D</em> has a SHAP interaction that opposes the general stroke severity main effect, especially increasing the odds of receiving thrombolysis for mild strokes. <em>Team_SMVTP6284P</em> strengthens the main effect of stroke severity - reducing the odds of receiving thrombolysis even further for mild strokes.</p>
<a class="reference internal image-reference" href="../_images/12ab_stroke_severity_interaction_example.jpg"><img alt="../_images/12ab_stroke_severity_interaction_example.jpg" src="../_images/12ab_stroke_severity_interaction_example.jpg" style="width: 600px;" /></a>
</section>
<section id="id1">
<h3>Hospital and stroke severity interaction<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>The main effect of prior disability is to progressively reduce the odds of receiving thrombolysis with increasing disability (a SHAP of +0.3 for mrS=0 down to -1.50 for mRS=5).</p>
<p><em>Team_XKAWN3771U</em> has a slighty higher general tendency to use thrombolysis than <em>Team_AKCGO9726K</em> (team main effect SHAP = 0.78 vs 0.45). <em>Team_XKAWN3771U</em> has a SHAP interaction that opposes the general prior disability main effect. <em>Team_AKCGO9726K</em> strengthens the main effect of pre-stroke disability - reducing the odds of receiving thrombolysis even further for mild strokes.</p>
<a class="reference internal image-reference" href="../_images/12ac_disability_interaction_example.jpg"><img alt="../_images/12ac_disability_interaction_example.jpg" src="../_images/12ac_disability_interaction_example.jpg" style="width: 600px;" /></a>
</section>
</section>
<section id="general-shap-interactions">
<h2>General SHAP interactions<a class="headerlink" href="#general-shap-interactions" title="Permalink to this headline">#</a></h2>
<p>All features may interact with each other, and SHAP captures all these 2-way interactions. We found that the feature main effects (without interactions) accounted for 62% of the total SHAP values, and 38% of the total SHAP values cam from interactions. The figure below shows interactions between all features, excluding the one-hot encoded hospitals.</p>
<p>Some key interactions are:</p>
<ul class="simple">
<li><p>If a stroke is haemorrhagic, then the interaction is such that the presence of haemorrhage cancels out much of the other SHAP effects (i.e. stroke severity does not matter if the stroke is haemorrhagic).</p></li>
<li><p>Likewise elsewhere we find that features that each give negative SHAP values alone have an interaction that attenuates the combined effect of the two features together a little.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/12a_shap_interactions_scatter.jpg"><img alt="../_images/12a_shap_interactions_scatter.jpg" src="../_images/12a_shap_interactions_scatter.jpg" style="width: 1200px;" /></a>
</section>
<section id="subgroup-analysis">
<h2>Subgroup analysis<a class="headerlink" href="#subgroup-analysis" title="Permalink to this headline">#</a></h2>
<p>We analyse the observed and predicted use of thrombolysis in subgroups of patients.Those groups are:</p>
<ul class="simple">
<li><p>Mild stroke severity (NIHSS &lt; 5)</p></li>
<li><p>No precise onset time</p></li>
<li><p>Existing pre-stroke disability (mRS &gt; 2)</p></li>
<li><p>An <em>‘ideal’</em> thrombolysable patient:</p>
<ul>
<li><p>Stroke severity NIHSS in range 10-25</p></li>
<li><p>Arrival-to-scan time &lt; 30 minutes</p></li>
<li><p>Stroke type = infarction</p></li>
<li><p>Precise onset time = True</p></li>
<li><p>Prior diability level (mRS) = 0</p></li>
<li><p>No use of AF anticoagulants</p></li>
<li><p>Onset-to-arrival time &lt; 90 minutes</p></li>
<li><p>Age &lt; 80 years</p></li>
<li><p>Onset during sleep = False</p></li>
</ul>
</li>
</ul>
<p>The figure below shows a boxplot of either observed (top) or predicted (bottom) use of thrombolysis.</p>
<p>The observed and predicted subgroup analysis show very similar general patterns (with r-squared=0.95, see figure below of comparison of predicted and observed use of thrombolysis at each hospital for all subgroups). The three subgroups of NIHSS &lt;5, no precise stroke onset time, and prestroke mRS &gt; 2, all had reduced thrombolysis use, and combining these non-ideal features reduced thrombolysis use further.</p>
<p>Some differences exist:</p>
<ul class="simple">
<li><p>The use of thrombolysi in <em>ideal</em> patients is a little low in the observed vs actual results (mean hopsital thrombolysis use = 89% vs 99%).</p></li>
<li><p>The predicted results show a stronger effect of combining non-ideal features.</p></li>
<li><p>The observed thrombolysis rate shows higher between-hopsital variation than the predicted thrombolysis rate. This may be partly explained by the observed thrombolsysi rate being on different patients at each hospital, but may also be partly exlained by actual use of thrombolysis being slightly more variable than predicted thrombolysis use (which will follow general hospial patterns, and will not include, for example, between-clinician variation at each hospital).</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/15a_actual_vs_modelled_subgroup_violin1.jpg"><img alt="../_images/15a_actual_vs_modelled_subgroup_violin1.jpg" src="../_images/15a_actual_vs_modelled_subgroup_violin1.jpg" style="width: 600px;" /></a>
<p>The correlation of predicted and observed use of thrombolysis at each hospital for all subgroups:</p>
<a class="reference internal image-reference" href="../_images/15a_subgroup_correlation.jpg"><img alt="../_images/15a_subgroup_correlation.jpg" src="../_images/15a_subgroup_correlation.jpg" style="width: 400px;" /></a>
<p>When we look at thrombolysis use in subgroups at each hospital we see that the observed thrombolysis use tended to reduce in parallel, along with total thrombolysis use, suggesting a shared caution in use of thrombolysis in ‘less ideal’ patients.</p>
<a class="reference internal image-reference" href="../_images/15a_actual_subgroup.jpg"><img alt="../_images/15a_actual_subgroup.jpg" src="../_images/15a_actual_subgroup.jpg" style="width: 800px;" /></a>
<p>This parallel reduction in use of thrombolysis across the subgroups was also seen in the predicted use of thrombolysis.</p>
<a class="reference internal image-reference" href="../_images/15_10k_subgroup.jpg"><img alt="../_images/15_10k_subgroup.jpg" src="../_images/15_10k_subgroup.jpg" style="width: 800px;" /></a>
</section>
<section id="a-comparison-of-thrombolysis-use-in-high-and-low-thrombolysing-units-by-feature-values">
<h2>A comparison of thrombolysis use in high and low thrombolysing units by feature values<a class="headerlink" href="#a-comparison-of-thrombolysis-use-in-high-and-low-thrombolysing-units-by-feature-values" title="Permalink to this headline">#</a></h2>
<p>This experiment plots the relationships between feature values and thrombolysis use for low and high thrombolysing hospitals. The high and low thrombolysing hopsitals are taken as the top and bottom 30 hospitals as ranked by the predicted thrombolysis use in the same 10k cohort of patients. We find that thrombolysis use in low thrombolysing hospitals follows the same general relationship with feature values as the high thrombolysing hospitals, but thrombolysis is consistently lower.</p>
<a class="reference internal image-reference" href="../_images/09_compare_thrombolysis_by_feature.jpg"><img alt="../_images/09_compare_thrombolysis_by_feature.jpg" src="../_images/09_compare_thrombolysis_by_feature.jpg" style="width: 800px;" /></a>
</section>
<section id="artificial-patients">
<h2>Artificial patients<a class="headerlink" href="#artificial-patients" title="Permalink to this headline">#</a></h2>
<p>We use artificial patients to investigate controlled changes to patients, and see how many hospitals are predicted to give thrombolysis.</p>
<p>We start with a ‘base patient’ who has features that are favourable to use of thrombolysis:</p>
<ul class="simple">
<li><p>Onset to arrival = 80 mins</p></li>
<li><p>Arrival to scan = 20 mins</p></li>
<li><p>Infarction = 1</p></li>
<li><p>NIHSS = 15</p></li>
<li><p>Prior disability level = 0</p></li>
<li><p>Precise onset time = 1</p></li>
<li><p>Use of AF anticoagulents = 0</p></li>
</ul>
<p>We then vary the following features in turn, keeping all other features the same as the base patient:</p>
<ul class="simple">
<li><p>NIHSS = 0-40</p></li>
<li><p>Prior disability level = 0-5</p></li>
<li><p>Precise onset time = 0-1</p></li>
</ul>
<p>The number of hospitals giving thrombolysis:</p>
<ul class="simple">
<li><p>Base patient: 132 (99%)</p></li>
<li><p>Base patient, but NIHSS = 5: 123 (93%)</p></li>
<li><p>Base patient, but pre-stroke disability = 2: 125 (95%)</p></li>
<li><p>Base patient, but estimated stroke onset time: 109 (83%)</p></li>
</ul>
<p>Combining two marginal features:</p>
<ul class="simple">
<li><p>Base patient, but NIHSS = 5 and pre-stroke disability = 2: 78 (59%)</p></li>
<li><p>Base patient, but NIHSS = 5 and estimated stroke onset time: 30 (23%)</p></li>
<li><p>Base patient, but pre-stroke disability = 2 and estimated stroke onset time: 26 (20%)</p></li>
</ul>
<p>Combining three marginal features:</p>
<ul class="simple">
<li><p>Base patient, but NIHSS = 5, pre-stroke disability = 2, estimated stroke onset time: 2 (1.5%)</p></li>
</ul>
<p>Starting with the ideal patient, and changing only feature at a time we observed the following changes in the proportion of thrombolysis that were predicted to give the patient thrombolysis:</p>
<a class="reference internal image-reference" href="../_images/20_synthetic_xgb_10_features_IVT_rate_vs_feature_values.jpg"><img alt="../_images/20_synthetic_xgb_10_features_IVT_rate_vs_feature_values.jpg" src="../_images/20_synthetic_xgb_10_features_IVT_rate_vs_feature_values.jpg" style="width: 800px;" /></a>
<p>We also studied combining changes to the patient (starting with the ‘ideal’ thrombolysable patient. The chart below shows the proportion of hospitals predicted to give a patient thrombolysis by altering stroke severity in combination with estimated (non-precise) onset time, mild pre-existing disability (mRS 2), or a combination of estimated onset time and mild pre-existing disability.</p>
<a class="reference internal image-reference" href="../_images/20_synthetic_xgb_10_features_interactions.jpg"><img alt="../_images/20_synthetic_xgb_10_features_interactions.jpg" src="../_images/20_synthetic_xgb_10_features_interactions.jpg" style="width: 400px;" /></a>
</section>
<section id="k-cohort-and-benchmark-decisions">
<h2>10k cohort and <em>‘benchmark’</em> decisions<a class="headerlink" href="#k-cohort-and-benchmark-decisions" title="Permalink to this headline">#</a></h2>
<p>In this experiment we predict, for each hospital, the expected use of thrombolysis for a 10k cohort of patients (the model is trained on the remaining 78,792 patients.</p>
<p>The 30 hospitals with the highest predicted thrombolysis use in the 10k cohort were considered <em>benchmark</em> hospitals.</p>
<p>We then took each hospitals own patients and predicted the thrombolysis decision that would made for each patient at each of the hospitals, taking a majority vote of those benchmark hospitals as the <em>benchmark decision</em> for that patient. We estimated the use of thrombolysis at each hospital if the benchmark decision was followed for all patients attending each hospital.</p>
<a class="reference internal image-reference" href="../_images/05_benchmark_thrombolysis_key_features.jpg"><img alt="../_images/05_benchmark_thrombolysis_key_features.jpg" src="../_images/05_benchmark_thrombolysis_key_features.jpg" style="width: 500px;" /></a>
<ul class="simple">
<li><p>83.3% decisions are identical between local and benchmark decisions.</p></li>
<li><p>Thrombolysis use would be increased 31.2% at non-benchmark hospitals if benchmark decisions were made at those hospitals. Overall, thrombolysis use, including at the benchmark hospitals, would be increased 20.7%. Thrombolysis at the 30 lowest thrombolysing units (judged by expected 10k thrombolysus rate) would be increased 60.2%.</p></li>
<li><p>The ratio of benchmark:local thrombolysis use ranged from 0.7 to 2.1.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./paper"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../xgb_10_features/91_learning_rate_optimisation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Evaluation of XGBoost learning rates on distribution of 10k thrombolysis rates</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kerry Pearn & Michael Allen<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>