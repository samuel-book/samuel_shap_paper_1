
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Probability, odds, and SHAP values (log odds shifts) &#8212; What would other emgerncy stroke teams do? Using explainable machine learning to understand variation in thrombolysis practice</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A simple worked example of Shap" href="shap_worked_example.html" />
    <link rel="prev" title="Data" href="data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">What would other emgerncy stroke teams do? Using explainable machine learning to understand variation in thrombolysis practice</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    SAMueL (Stroke Audit Machine Learning): What would other emergency stroke teams? Summary and key work
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introductory content
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data.html">
   Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Probability, odds, and SHAP values (log odds shifts)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="shap_worked_example.html">
   A simple worked example of Shap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/90_shap_interactions_on_titanic.html">
   Examining interactions between features with SHAP interactions: Using Titanic survival as an example
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Predicting thrombolysis use and explaining the predictions with Shap
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/01_xgb_combined_fit_feature_selection.html">
   XGBoost feature selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/07_correlation.html">
   Check correlation between features selected for the model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/02_xgb_combined_fit_accuracy_key_features.html">
   Measuring accuracy of XGBoost models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/02a_xgb_combined_fit_most_thrombolysable_patients.html">
   An anlysis of the characteristics of the most thrombolysable patient at each hopsital
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/03_xgb_combined_shap_key_features.html">
   Explaining XGBoost model predictions with SHAP values
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Comparing thrombolysis decisions between hospitals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/04_compare_10k_cohort_key_features.html">
   A comparison of 10k cohort thrombolysis rates across hospitals, and comparison with hospital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/15_10k_thrombolysis_subgroups.html">
   A comparison of expected 10k cohort thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/15a_observed_thrombolysis_subgroup_analysis.html">
   A comparison of actual thrombolysis rates across hospitals: subgroup analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/05_compare_benchmark_decisions_key_features.html">
   Compare local thrombolysis decisions with benchmark decisions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/08_xgb_combined_fit_shap_high_vs_low_thrombolysing_units.html">
   Comparing Shap values between high and low thrombolysing hospitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/09_plot_thrombolysis_at_high_vs_low_thrombolysing_units.html">
   Plotting thrombolysis rate by feature value for low and high thrombolysing hopsitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/03c_xgb_shap_values_and_interaction_values_focus_on_ohe_hospitals.html">
   Explaining XGBoost model predictions with SHAP values: Analysis of hopsital SHAP values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12a_xgb_shap_interactions.html">
   Describing model predictions, using SHAP values and SHAP interactions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12aa_xgb_shap_interactions_focus_on_onsettime.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Precise Onset Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12ab_xgb_shap_interactions_focus_on_severity.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with Stroke Severity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/12ac_xgb_shap_interactions_focus_on_disability.html">
   Describing model predictions, using SHAP values and SHAP interactions focusing on how Hospitals interact with pre-stroke disability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/20_synthetic_patients.html">
   Investigating the effect of patient features by varying feature values in artificial patients
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/50_bagging_variation.html">
   Evaluating variation in model predictions and predicted 10k thrombolysis rate using bootstrap models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xgb_10_features/91_learning_rate_optimisation.html">
   Evaluation of XGBoost learning rates on distribution of 10k thrombolysis rates
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Paper (Work In Progress)
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../paper/abstract.html">
   Abstract
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../paper/6_appendix.html">
   Appendix
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/introduction/odds_prob.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#probability">
   Probability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#odds">
   Odds
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shap-values-log-odds-shifts">
   SHAP values: log odds shifts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#positive-shap-values-examples-of-how-shap-change-odds-and-probabilities">
     Positive SHAP values: examples of how SHAP change odds and probabilities
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#negative-shap-values-examples-of-how-shap-change-odds-and-probabilities">
     Negative SHAP values: examples of how SHAP change odds and probabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-worked-example-in-predicting-use-of-thrombolysis-in-stroke">
   A worked example in predicting use of thrombolysis in stroke
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#observations-about-shap-values">
     Observations about SHAP values
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Probability, odds, and SHAP values (log odds shifts)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#probability">
   Probability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#odds">
   Odds
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shap-values-log-odds-shifts">
   SHAP values: log odds shifts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#positive-shap-values-examples-of-how-shap-change-odds-and-probabilities">
     Positive SHAP values: examples of how SHAP change odds and probabilities
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#negative-shap-values-examples-of-how-shap-change-odds-and-probabilities">
     Negative SHAP values: examples of how SHAP change odds and probabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-worked-example-in-predicting-use-of-thrombolysis-in-stroke">
   A worked example in predicting use of thrombolysis in stroke
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#observations-about-shap-values">
     Observations about SHAP values
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="probability-odds-and-shap-values-log-odds-shifts">
<h1>Probability, odds, and SHAP values (log odds shifts)<a class="headerlink" href="#probability-odds-and-shap-values-log-odds-shifts" title="Permalink to this headline">#</a></h1>
<p>Many of us find it easiest to think of the chance of something occurring as a probability. For example, there might be a probability of 10% that it will rain today. That is the same as saying there will be one rainy day out of ten days for days with this given probability of rain.</p>
<p>In our stroke thrombolysis model, SHAP values tell us how knowing something particular about a patient (such as the patient <em>feature</em>, ‘Is their stroke caused by a clot or a bleed?’) adjusts our prediction of whether they will receive thrombolysis or not.</p>
<p>This is made a little more complicated for us because SHAP is usually reported as a <em>log odds shift</em>. It is useful for us to see how those relate to probabilities, and get a sense of how significant SHAP values in the range of 0.5 to 5 (or -0.5 to -5) are, as that is a common range of SHAP values that we will see in our models.</p>
<section id="probability">
<h2>Probability<a class="headerlink" href="#probability" title="Permalink to this headline">#</a></h2>
<p>We will take the example that SHAP reports that a model’s base probability prediction, before the contribution of features is 0.25, or a 25% probability of receiving thrombolysis; that is 1 in 4 patients with this prediction would be expected to receive thrombolysis.</p>
</section>
<section id="odds">
<h2>Odds<a class="headerlink" href="#odds" title="Permalink to this headline">#</a></h2>
<p><em>Probability</em> expresses the chance of something happening as the number of positive occurrences as a fraction of all occurrences (i.e. the number of patients receiving thrombolysis as a fraction of the total number of patients).</p>
<p><em>Odds</em> express the chance of something happening as the ratio of the number of positive occurrences (i.e. receiving thrombolysis) to the number of negative occurrences (i.e. <em>not</em> receiving thrombolysis).</p>
<p>If we have probability prediction of 0.25 would receive thrombolysis, that would mean 1 in 4 of those patients receive thrombolysis. Expressed as odds, for every one patient that receives thrombolysis, three will not. The odds are expressed as 1:3 or 1/3. This may also be calculated as a decimal (1 divided by 3), 0.333.</p>
<p>Odds (O) and probability (P) may be converted with the following equations:</p>
<p>(1) O = P / (1 - P)</p>
<p>(2) P = O / (1 + O)</p>
</section>
<section id="shap-values-log-odds-shifts">
<h2>SHAP values: log odds shifts<a class="headerlink" href="#shap-values-log-odds-shifts" title="Permalink to this headline">#</a></h2>
<p>Here we will calculate the effect of SHAP values, and try and build some intuition on the size of effect SHAP values of 0.5 to 5 give (we will look at positive and negative SHAP values).</p>
<p>SHAP usually outputs the effect of a particular feature in how much it shifts the odds. For reasons we will not go into here, that shift (which is the ‘SHAP value’) is usually given in ‘log odds’ (the logarithm of the odds value). For the mathematically inclined, we use the natural log (<em>ln</em>).</p>
<p>Let’s look at some SHAP values (log odds) and see how much they change the odds of receiving thrombolysis.</p>
<p>First we’ll look at the shift in odds the SHAP values give. This is calculated as <em>shift = exp(SHAP)</em></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>SHAP (log odds)</p></th>
<th class="head"><p>Shift in odds (multiply original odds)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.5</p></td>
<td><p>1.65</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2.72</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>7.39</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>20.1</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>54.6</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>148</p></td>
</tr>
</tbody>
</table>
<section id="positive-shap-values-examples-of-how-shap-change-odds-and-probabilities">
<h3>Positive SHAP values: examples of how SHAP change odds and probabilities<a class="headerlink" href="#positive-shap-values-examples-of-how-shap-change-odds-and-probabilities" title="Permalink to this headline">#</a></h3>
<p>Now let us work through an example of starting with a known baseline <em>probability</em> (before we consider what we know about a particular patient feature), converting that to <em>odds</em>, applying a SHAP <em>log odds shift</em> for that particular feature, and converting back to <em>probability</em> after we have applied the influence of that feature.</p>
<p>Here are the effects of those shifts on our baseline probability of 0.25.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Starting P</p></th>
<th class="head"><p>Starting O<br>(P / (1 - P))</p></th>
<th class="head"><p>SHAP</p></th>
<th class="head"><p>Shift in odds<br>(exp(SHAP))</p></th>
<th class="head"><p>Shifted O<br>(O * Shift)</p></th>
<th class="head"><p>Shifted P (%)<br>(O / (1 + O))</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>0.5</p></td>
<td><p>1.65</p></td>
<td><p>0.550</p></td>
<td><p>0.3547 (35.5%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>1</p></td>
<td><p>2.72</p></td>
<td><p>0.907</p></td>
<td><p>0.4754 (47.5%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>2</p></td>
<td><p>7.39</p></td>
<td><p>2.46</p></td>
<td><p>0.7112 (71.1%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>3</p></td>
<td><p>20.1</p></td>
<td><p>6.70</p></td>
<td><p>0.8700 (87.0%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>4</p></td>
<td><p>54.6</p></td>
<td><p>18.2</p></td>
<td><p>0.9479 (94.8%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>5</p></td>
<td><p>148</p></td>
<td><p>49.5</p></td>
<td><p>0.9802 (98.0%)</p></td>
</tr>
</tbody>
</table>
<p>So, for example, a SHAP value of 0.5 for one particular feature tells us that that particular feature in that patient shifts our expected probability of that patient receiving thrombolysis from 25% to 36%. A SHAP value of 5 for the same feature would shift the probability of that patient receiving thrombolysis up to 98%.</p>
</section>
<section id="negative-shap-values-examples-of-how-shap-change-odds-and-probabilities">
<h3>Negative SHAP values: examples of how SHAP change odds and probabilities<a class="headerlink" href="#negative-shap-values-examples-of-how-shap-change-odds-and-probabilities" title="Permalink to this headline">#</a></h3>
<p>If we have a negative SHAP value then odds are reduced (a SHAP of -1 will lead to the odds being divided by 2.72, which is the same as multiplying by 1/2.72, which is 0.3679):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Starting P</p></th>
<th class="head"><p>Starting O<br>(P / (1 - P))</p></th>
<th class="head"><p>SHAP</p></th>
<th class="head"><p>Shift in odds<br>(exp(SHAP))</p></th>
<th class="head"><p>Shifted O<br>(O * Shift)</p></th>
<th class="head"><p>Shifted P (%)<br>(O / (1 + O))</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-0.5</p></td>
<td><p>0.6065</p></td>
<td><p>0.2022</p></td>
<td><p>0.1682 (16.8%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-1</p></td>
<td><p>0.3679</p></td>
<td><p>0.1226</p></td>
<td><p>0.1092 (10.9%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-2</p></td>
<td><p>0.1353</p></td>
<td><p>0.0451</p></td>
<td><p>0.0432 (4.32%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-3</p></td>
<td><p>0.0498</p></td>
<td><p>0.0166</p></td>
<td><p>0.0163 (1.63%)</p></td>
</tr>
<tr class="row-even"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-4</p></td>
<td><p>0.0183</p></td>
<td><p>0.0061</p></td>
<td><p>0.0061 (0.61%)</p></td>
</tr>
<tr class="row-odd"><td><p>0.25 (25%)</p></td>
<td><p>0.333</p></td>
<td><p>-5</p></td>
<td><p>0.0067</p></td>
<td><p>0.0022</p></td>
<td><p>0.0022 (0.22%)</p></td>
</tr>
</tbody>
</table>
<p>So, for example, a SHAP value of -0.5 for one particular feature tells us that that particular feature in that patient shifts our expected probability of that patient receiving thrombolysis from 25% to 17%. A SHAP value of 5 for the same feature would shift the probability of that patient receiving thrombolysis down to 2%.</p>
</section>
</section>
<section id="a-worked-example-in-predicting-use-of-thrombolysis-in-stroke">
<h2>A worked example in predicting use of thrombolysis in stroke<a class="headerlink" href="#a-worked-example-in-predicting-use-of-thrombolysis-in-stroke" title="Permalink to this headline">#</a></h2>
<p>The example below shows how six patient features change the model prediction of a patient receiving thrombolysis, from a baseline of 25% (with nothing known about the patient) to 95% after the contribution of six features. The relative contribution of each feature is made clear by its SHAP value. SHAP are additive in their effects; for example if one feature has a SHAP of +1.5, the influence of that feature on the model prediction would be exactly cancelled out by three other features with SHAP values of -0.5.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Patient feature and value</p></th>
<th class="head"><p>SHAP</p></th>
<th class="head"><p>Shift<br>(exp(SHAP))</p></th>
<th class="head"><p>Odds<br>(Previous odds * Shift)</p></th>
<th class="head"><p>Probability<br>(O / (1 + O)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Base odds</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>0.33</p></td>
<td><p>25%</p></td>
</tr>
<tr class="row-odd"><td><p>Stroke type = infarction</p></td>
<td><p>1.8</p></td>
<td><p>6.05</p></td>
<td><p>2</p></td>
<td><p>67%</p></td>
</tr>
<tr class="row-even"><td><p>Stroke severity (NIHSS) = 20</p></td>
<td><p>1.5</p></td>
<td><p>4.482</p></td>
<td><p>8.95</p></td>
<td><p>90%</p></td>
</tr>
<tr class="row-odd"><td><p>Prior disability (mRS) = 3</p></td>
<td><p>-0.7</p></td>
<td><p>0.497</p></td>
<td><p>4.44</p></td>
<td><p>82%</p></td>
</tr>
<tr class="row-even"><td><p>Precise onset time = Yes</p></td>
<td><p>0.6</p></td>
<td><p>1.822</p></td>
<td><p>8.1</p></td>
<td><p>89%</p></td>
</tr>
<tr class="row-odd"><td><p>Arrival-to-scan time (mins) = 30</p></td>
<td><p>0.5</p></td>
<td><p>1.649</p></td>
<td><p>13.35</p></td>
<td><p>93%</p></td>
</tr>
<tr class="row-even"><td><p>Use of AF anticoagulants = No</p></td>
<td><p>0.3</p></td>
<td><p>1.35</p></td>
<td><p>18.02</p></td>
<td><p>95%</p></td>
</tr>
</tbody>
</table>
<section id="observations-about-shap-values">
<h3>Observations about SHAP values<a class="headerlink" href="#observations-about-shap-values" title="Permalink to this headline">#</a></h3>
<p>We begin to get some intuition on SHAP values. A SHAP value of 0.5 (or -0.5) leads to a small, but still noticeable, change in probability. SHAP values of 5 or -5 have effectively pushed probabilities to one extreme or the other.</p>
<p>Everything we know about a patient (the patient ‘features’) may shift the predicted probability of receiving thrombolysis. Each patient feature will have its own SHAP value depending on the value of that feature. <em>Stroke severity</em>, for example, may be in the range 0-42, and the SHAP value will depend on the value of the feature. The final predicted probability of receiving thrombolysis will be the model baseline prediction (the predicted probability of receiving thrombolysis before anything is known about a patient) and the sum of the influences of each of the features.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./introduction"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="shap_worked_example.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A simple worked example of Shap</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kerry Pearn & Michael Allen<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>